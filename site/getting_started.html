<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Começando com Rails — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/search.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/search.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr-documents.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Começando com Rails — Ruby on Rails Guides" />
  <meta name="description" content="Começando com RailsEste guia aborda a instalação e a execução do Ruby on Rails.Depois de ler este guia, você vai saber: Como instalar o Rails, criar uma nova aplicação Rails e conectar sua aplicação com um banco de dados. A estrutura geral de uma aplicação Rails. Os princípios básicos do MVC (Model, View, Controller) e design RESTful. Como gerar rapidamente as peças iniciais de uma aplicação Rails." />
  <meta property="og:description" content="Começando com RailsEste guia aborda a instalação e a execução do Ruby on Rails.Depois de ler este guia, você vai saber: Como instalar o Rails, criar uma nova aplicação Rails e conectar sua aplicação com um banco de dados. A estrutura geral de uma aplicação Rails. Os princípios básicos do MVC (Model, View, Controller) e design RESTful. Como gerar rapidamente as peças iniciais de uma aplicação Rails." />
  <meta property="og:locale" content="pt_BR" />
  <meta property="og:site_name" content="Guia Ruby on Rails" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Veja mais em <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        Mais Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guia oficial</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://stackoverflow.com/questions/tagged/ruby-on-rails">Peça por ajuda</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribua no GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Voltar para a página principal">Guiarails.com.br</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-search guides-search-large">
          <input class="search-box search-box-large nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Guias</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <div class="guides-section-container">
                <div class="guides-section">
                  <dt>Comece aqui</dt>
                  <dd><a href="getting_started.html">Começando com Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                  <dd><a href="active_model_basics.html">Active Model Basics</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="action_view_overview.html">Action View Overview</a></dd>
                  <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                  <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                  <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Outros componentes</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                  <dd><a href="action_mailbox_basics.html">Action Mailbox Basics</a></dd>
                  <dd><a href="action_text_overview.html">Action Text Overview</a></dd>
                  <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage Overview</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable Overview</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Indo mais fundo</dt>
                  <dd><a href="i18n.html">Rails Internationalization (I18n) API</a></dd>
                  <dd><a href="testing.html">Testing Rails Applications</a></dd>
                  <dd><a href="security.html">Securing Rails Applications</a></dd>
                  <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                  <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                  <dd><a href="command_line.html">The Rails Command Line</a></dd>
                  <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                  <dd><a href="initialization.html">The Rails Initialization Process</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</a></dd>
                  <dd><a href="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</a></dd>
                  <dd><a href="caching_with_rails.html">Caching with Rails: An Overview</a></dd>
                  <dd><a href="active_support_instrumentation.html">Active Support Instrumentation</a></dd>
                  <dd><a href="api_app.html">Using Rails for API-only Applications</a></dd>
                  <dd><a href="active_record_postgresql.html">Active Record and PostgreSQL</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Multiple Databases with Active Record</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Estendendo o Rails</dt>
                  <dd><a href="plugins.html">The Basics of Creating Rails Plugins</a></dd>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                  <dd><a href="engines.html">Getting Started with Engines</a></dd>
                  <dd><a href="threading_and_code_execution.html">Threading and Code Execution in Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Contribuições</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Políticas</dt>
                  <dd><a href="maintenance_policy.html">Maintenance Policy for Ruby on Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Release Notes</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0 Release Notes - Agosto 2019</a></dd>
                  <dd><a href="5_2_release_notes.html">Version 5.2 - April 2018</a></dd>
                  <dd><a href="5_1_release_notes.html">Version 5.1 - April 2017</a></dd>
                  <dd><a href="5_0_release_notes.html">Version 5.0 - June 2016</a></dd>
                  <dd><a href="4_2_release_notes.html">Version 4.2 - December 2014</a></dd>
                  <dd><a href="4_1_release_notes.html">Version 4.1 - April 2014</a></dd>
                  <dd><a href="4_0_release_notes.html">Version 4.0 - June 2013</a></dd>
                  <dd><a href="3_2_release_notes.html">Version 3.2 - January 2012</a></dd>
                  <dd><a href="3_1_release_notes.html">Version 3.1 - August 2011</a></dd>
                  <dd><a href="3_0_release_notes.html">Version 3.0 - August 2010</a></dd>
                  <dd><a href="2_3_release_notes.html">Version 2.3 - March 2009</a></dd>
                  <dd><a href="2_2_release_notes.html">Version 2.2 - November 2008</a></dd>
                </div>
            </div>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribua</a></li>
        <li class="guides-search guides-search-small">
          <input class="search-box search-box-small nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guias</option>
              <optgroup label="Comece aqui">
                  <option value="getting_started.html">Começando com Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
                  <option value="active_model_basics.html">Active Model Basics</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="action_view_overview.html">Action View Overview</option>
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Outros componentes">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="action_mailbox_basics.html">Action Mailbox Basics</option>
                  <option value="action_text_overview.html">Action Text Overview</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="active_storage_overview.html">Active Storage Overview</option>
                  <option value="action_cable_overview.html">Action Cable Overview</option>
              </optgroup>
              <optgroup label="Indo mais fundo">
                  <option value="i18n.html">Rails Internationalization (I18n) API</option>
                  <option value="testing.html">Testing Rails Applications</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">The Rails Command Line</option>
                  <option value="asset_pipeline.html">The Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="initialization.html">The Rails Initialization Process</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</option>
                  <option value="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</option>
                  <option value="caching_with_rails.html">Caching with Rails: An Overview</option>
                  <option value="active_support_instrumentation.html">Active Support Instrumentation</option>
                  <option value="api_app.html">Using Rails for API-only Applications</option>
                  <option value="active_record_postgresql.html">Active Record and PostgreSQL</option>
                  <option value="active_record_multiple_databases.html">Multiple Databases with Active Record</option>
              </optgroup>
              <optgroup label="Estendendo o Rails">
                  <option value="plugins.html">The Basics of Creating Rails Plugins</option>
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
                  <option value="engines.html">Getting Started with Engines</option>
                  <option value="threading_and_code_execution.html">Threading and Code Execution in Rails</option>
              </optgroup>
              <optgroup label="Contribuições">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Políticas">
                  <option value="maintenance_policy.html">Maintenance Policy for Ruby on Rails</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="6_0_release_notes.html">6.0 Release Notes - Agosto 2019</option>
                  <option value="5_2_release_notes.html">Version 5.2 - April 2018</option>
                  <option value="5_1_release_notes.html">Version 5.1 - April 2017</option>
                  <option value="5_0_release_notes.html">Version 5.0 - June 2016</option>
                  <option value="4_2_release_notes.html">Version 4.2 - December 2014</option>
                  <option value="4_1_release_notes.html">Version 4.1 - April 2014</option>
                  <option value="4_0_release_notes.html">Version 4.0 - June 2013</option>
                  <option value="3_2_release_notes.html">Version 3.2 - January 2012</option>
                  <option value="3_1_release_notes.html">Version 3.1 - August 2011</option>
                  <option value="3_0_release_notes.html">Version 3.0 - August 2010</option>
                  <option value="2_3_release_notes.html">Version 2.3 - March 2009</option>
                  <option value="2_2_release_notes.html">Version 2.2 - November 2008</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Começando com Rails</h2><p>Este guia aborda a instalação e a execução do Ruby on Rails.</p><p>Depois de ler este guia, você vai saber:</p>
<ul>
<li>Como instalar o Rails, criar uma nova aplicação Rails e conectar sua
aplicação com um banco de dados.</li>
<li>A estrutura geral de uma aplicação Rails.</li>
<li>Os princípios básicos do MVC (<strong>Model</strong>, <strong>View</strong>, <strong>Controller</strong>) e design <strong>RESTful</strong>.</li>
<li>Como gerar rapidamente as peças iniciais de uma aplicação Rails.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#premissas-do-guia">Premissas do Guia</a></li>
<li><a href="#o-que-e-o-rails-questionmark">O que é o Rails?</a></li>
<li>
<a href="#criando-um-novo-projeto-em-rails">Criando um Novo Projeto em Rails</a>

<ul>
<li><a href="#criando-um-novo-projeto-em-rails-instalando-o-rails">Instalando o Rails</a></li>
<li><a href="#criando-a-aplicacao-blog">Criando a Aplicação Blog</a></li>
</ul>
</li>
<li>
<a href="#ola-rails-bang">Olá, Rails!</a>

<ul>
<li><a href="#inicializando-o-servidor-web">Inicializando o Servidor Web</a></li>
<li><a href="#diga-ola-rails">Diga "Olá", Rails</a></li>
<li><a href="#configuracao-da-pagina-inicial-da-aplicacao">Configuração da Página Inicial da Aplicação</a></li>
</ul>
</li>
<li>
<a href="#iniciando-e-executando">Iniciando e Executando</a>

<ul>
<li><a href="#preparando-a-base">Preparando a base</a></li>
<li><a href="#o-primeiro-formulario">O primeiro formulário</a></li>
<li><a href="#criando-artigos">Criando artigos</a></li>
<li><a href="#criando-um-model-para-o-article-artigo-ingles">Criando um  <em>model</em> para o <code>Article</code> (artigo, inglês)</a></li>
<li><a href="#executando-uma-migration">Executando uma <em>Migration</em></a></li>
<li><a href="#salvando-dados-no-controller">Salvando dados no <em>Controller</em></a></li>
<li><a href="#mostrando-artigos">Mostrando Artigos</a></li>
<li><a href="#listando-todos-os-artigos">Listando todos os artigos</a></li>
<li><a href="#adicionando-links">Adicionando links</a></li>
<li><a href="#adicionando-algumas-validacoes">Adicionando Algumas Validações</a></li>
<li><a href="#atualizando-artigos">Atualizando Artigos</a></li>
<li><a href="#usando-partials-para-limpar-duplicacoes-em-views">Usando <em>partials</em> para limpar duplicações em <em>views</em></a></li>
<li><a href="#deletando-artigos">Deletando Artigos</a></li>
</ul>
</li>
<li>
<a href="#adicionando-um-segundo-model">Adicionando um Segundo Model</a>

<ul>
<li><a href="#gerando-um-model">Gerando um Model</a></li>
<li><a href="#associando-models">Associando Models</a></li>
<li><a href="#adicionando-a-rota-para-comentarios">Adicionando a Rota para Comentários</a></li>
<li><a href="#gerando-um-controller">Gerando um Controller</a></li>
</ul>
</li>
<li>
<a href="#refatorando">Refatorando</a>

<ul>
<li><a href="#renderizando-colecoes-de-partials">Renderizando Coleções de <em>Partials</em></a></li>
<li><a href="#renderizando-um-formulario-com-partial">Renderizando um Formulário com <em>Partial</em></a></li>
</ul>
</li>
<li>
<a href="#deletando-comentarios">Deletando Comentários</a>

<ul>
<li><a href="#excluindo-objetos-associados">Excluindo objetos associados</a></li>
</ul>
</li>
<li>
<a href="#seguranca">Segurança</a>

<ul>
<li><a href="#autenticacao-basica">Autenticação Básica</a></li>
<li><a href="#outras-consideracoes-de-seguranca">Outras Considerações de Segurança</a></li>
</ul>
</li>
<li><a href="#o-que-vem-depois-questionmark">O que vem depois?</a></li>
<li><a href="#dicas-de-configuracao">Dicas de Configuração</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="premissas-do-guia"><a class="anchorlink" href="#premissas-do-guia">1 Premissas do Guia</a></h3><p>Este guia é projetado para iniciantes que desejam começar uma aplicação Rails do
zero. Ele não assume que você tenha nenhuma experiência anterior com Rails.</p><p>O Rails é um <em>framework</em> para aplicações web que é executado em cima da linguagem
de programação Ruby. Se você não tem nenhuma experiência com Ruby, você vai
achar a curva de aprendizado bastante íngrime começando direto com Rails.
Existem diversas listas organizadas de materiais online para aprender Ruby:</p>
<ul>
<li><a href="https://www.ruby-lang.org/en/documentation/">Site Oficial da Linguagem de Programação Ruby (Em inglês)</a></li>
<li><a href="https://github.com/vhf/free-programming-books/blob/master/free-programming-books.md#ruby">Lista de Livros Grátis de Programação (Em inglês)</a></li>
</ul>
<p>Fique atento que alguns materiais, apesar de excelentes, envolvem versões antigas
do Ruby chegando a 1.6, e frequentemente 1.8, e não incluem parte da sintaxe que você
vai ver no seu dia-a-dia desenvolvendo com Rails.</p><h3 id="o-que-e-o-rails-questionmark"><a class="anchorlink" href="#o-que-e-o-rails-questionmark">2 O que é o Rails?</a></h3><p>Rails é um <em>framework</em> de desenvolvimento de aplicações <em>web</em> escrito na linguagem de programação Ruby.
Foi projetado para facilitar o desenvolvimento de aplicações <em>web</em>, criando premissas sobre tudo que uma pessoa desenvolvedora precisa para começar. Permite que você escreva menos código, enquanto realiza mais do que em muitas outras linguagens ou <em>frameworks.</em> Pessoas desenvolvedoras experientes em Rails, também dizem que desenvolver aplicações web ficou mais divertido.</p><p>Rails é um software opinativo. Assumindo que há uma "melhor" maneira para fazer as coisas, e foi projetado para encorajar essa maneira - e, em alguns casos para desencorajar alternativas. Se você aprender o "Rails Way", provavelmente terá um grande aumento de produtividade. Se você insistir nos velhos hábitos de outras linguagens, tentando usar os padrões que você aprendeu em outro lugar, você pode ter uma experiência menos feliz.</p><p>A filosofia do Rails possui dois princípios fundamentais:</p>
<ul>
<li>
<strong>Não repita a si mesmo:</strong> DRY (don't repeat yourself) é um conceito de desenvolvimento de software que estabelece que "Todo conhecimento deve possuir uma representação única, de autoridade e livre de ambiguidades em todo o sistema.". Ao não escrever as mesmas informações repetidamente, o código fica mais fácil de manter, de expandir e com menos <em>bugs</em>.</li>
<li>
<strong>Convenção sobre configuração:</strong> O Rails possui convenções sobre as melhores maneiras de fazer muitas coisas em uma aplicação web, devido a essas convenções você não precisa especificar detalhes através de arquivos de configuração infinitos.</li>
</ul>
<h3 id="criando-um-novo-projeto-em-rails"><a class="anchorlink" href="#criando-um-novo-projeto-em-rails">3 Criando um Novo Projeto em Rails</a></h3><p>A melhor forma de ler esse guia é seguir o passo à passo. Todos os passos são
essenciais para rodar a aplicação de exemplo e nenhum código ou passos adicionais
serão necessários.</p><p>Seguindo este guia, você irá criar um projeto em <em>Rails</em> chamado de
<code>blog</code>, um <em>weblog</em> (muito) simples. Antes de você começar a construir a aplicação,
você precisa ter certeza de ter o <em>Rails</em> instalado.</p><div class="info"><p>Os exemplos à seguir usam <code>$</code> para representar seu <em>prompt</em> de terminal em um
sistema operacional baseado em UNIX, mesmo que ele tenha sido customizado para parecer diferente.
Se você está utilizando Windows, seu <em>prompt</em> será parecido com algo como <code>c:\source_code&gt;</code></p></div><h4 id="criando-um-novo-projeto-em-rails-instalando-o-rails"><a class="anchorlink" href="#criando-um-novo-projeto-em-rails-instalando-o-rails">3.1 Instalando o Rails</a></h4><p>Antes de você instalar o Rails, você deve validar para ter certeza que seu sistema
tem os pré requisitos necessários instalados. Esses incluem:</p>
<ul>
<li>Ruby </li>
<li>SQLite3</li>
<li>Node.js</li>
<li>Yarn</li>
</ul>
<h5 id="instalando-o-ruby"><a class="anchorlink" href="#instalando-o-ruby">3.1.1 Instalando o Ruby</a></h5><p>Abra o <em>prompt</em> de linha de comando. No <em>macOS</em> abra o <em>Terminal.app</em>, no <em>Windows</em>
escolha <em>executar</em> no menu inicial e digite 'cmd.exe'. Qualquer comando que antecede
o sinal de dólar <code>$</code> deverá ser rodado em linha de comando. Verifique se você tem a
versão atual do Ruby instalado:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">ruby</span> <span class="nt">-v</span>
<span class="go">ruby 2.5.0
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-72ed2ee57e87756ad566007ac1059db5">ruby -v
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-72ed2ee57e87756ad566007ac1059db5">Copiar</button>
</div>
<p>O Rails necessita da versão Ruby 2.5.0 ou mais atual. Se o número da versão retornada
for menor que este número, você precisará instalar uma versão do Ruby mais atual.</p><div class="info"><p>Para instalar o Ruby e o Ruby on Rails mais rápido no seu sistema operacional Windows,
você pode usar o <a href="http://railsinstaller.org">Rails Installer</a>. Para mais informações de instalação
de outros Sistemas Operacionais, dê uma olhada em <a href="https://www.ruby-lang.org/en/documentation/installation/">ruby-lang.org</a>.</p></div><p>Se você está utilizando o Windowns, você deve também instalar o
<a href="https://rubyinstaller.org/downloads/">Ruby Installer Development Kit</a>.</p><h5 id="instalando-o-sqlite3"><a class="anchorlink" href="#instalando-o-sqlite3">3.1.2 Instalando o SQLite3</a></h5><p>Você também precisará instalar o banco de dados SQLite3.
Muitos sistemas operacionais populares semelhantes ao UNIX são fornecidos com uma versão compatível do SQLite3.
No Windows, se você instalou o Rails pelo instalador do Rails, você
já possui o SQLite instalado. Você também podem achar mais instruções de instalação em <a href="https://www.sqlite.org">SQLite3 website</a>.
Verifique se está corretamente instalado e no seu <em>PATH</em></p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">sqlite3</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-907d9c26509fae85274fb747e74d56be">sqlite3 --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-907d9c26509fae85274fb747e74d56be">Copiar</button>
</div>
<p>O programa deverá reportar sua versão.</p><h5 id="instalando-o-node-js-e-yarn"><a class="anchorlink" href="#instalando-o-node-js-e-yarn">3.1.3 Instalando o Node.js e Yarn</a></h5><p>Por fim, você precisará do Node.js e o Yarn instalados para gerenciar o JavaScript da sua aplicação.</p><p>Encontre as instruções de instalação no <a href="https://nodejs.org/en/download/">site do Node.js</a> e
verifique se está instalado corretamente com o seguinte comando:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">node</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9c71c2ed454e8101b36b4e8249a22f9d">node --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9c71c2ed454e8101b36b4e8249a22f9d">Copiar</button>
</div>
<p>A versão do Node.js deve ser impressa. Certifique-se de que é maior
que 8.16.0.</p><p>Para instalar o Yarn, siga as instruções de instalação
instruções no <a href="https://classic.yarnpkg.com/en/docs/install">site do Yarn</a>.</p><p>A execução deste comando deve imprimir a versão do Yarn:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">yarn</span> <span class="nt">-v</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6a78586f22ad16ed88edadab60a53b3c">yarn -v
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6a78586f22ad16ed88edadab60a53b3c">Copiar</button>
</div>
<p>Se aparecer algo como "1.22.0", o Yarn foi instalado corretamente.</p><h5 id="criando-um-novo-projeto-em-rails-instalando-o-rails-instalando-o-rails"><a class="anchorlink" href="#criando-um-novo-projeto-em-rails-instalando-o-rails-instalando-o-rails">3.1.4 Instalando o Rails</a></h5><p>Para instalar o Rails, use o comando <code>gem install</code> fornecido pelo RubyGems:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">gem install rails</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d1ec69ffae5d1c96d3bd85747387d95c">gem install rails
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d1ec69ffae5d1c96d3bd85747387d95c">Copiar</button>
</div>
<p>Para verificar se você tem tudo instalado corretamente, você deve rodar o comando à seguir:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-547cdefb4555a6a3340f476a66ad47bd">rails --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-547cdefb4555a6a3340f476a66ad47bd">Copiar</button>
</div>
<p>Se esse comando retornar algo como "Rails 6.0.0", você está pronto para continuar.</p><h4 id="criando-a-aplicacao-blog"><a class="anchorlink" href="#criando-a-aplicacao-blog">3.2 Criando a Aplicação Blog</a></h4><p>O Rails vem com vários scripts chamados <em>generators</em> que são projetados para tornar
sua vida de desenvolvedor fácil, criando tudo que é necessário para começar a
trabalhar em uma tarefa em particular. Um desses é o <em>generator</em> de nova aplicação,
que irá te fornecer a base de uma nova aplicação em Rails para que você não precise
escrever tudo sozinho.</p><p>Para utilizar esse <em>generator</em>, abra um terminal, navegue para um diretório onde
você tenha permissão para criar arquivos, e digite:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new blog
</code></pre>
<textarea class="clipboard-content" id="clipboard-9a3e42b48c4c5268e64414a07e0c0c44">rails new blog
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9a3e42b48c4c5268e64414a07e0c0c44">Copiar</button>
</div>
<p>Este comando irá criar uma aplicação em Rails chamada Blog em um diretório <code>blog</code>
e irá instalar as dependências das <em>gems</em> que já foram mencionadas no <code>Gemfile</code>
usando <code>bundle install</code>.</p><div class="note"><p>Se você está utilizando um subsistema Windows para Linux então existem
algumas limitações nas notificações dos arquivos do sistema que significa que você
deve desabilitar as gems <code>spring</code> e <code>listen</code>, o que poderá ser feito rodando o comando
<code>rails new blog --skip-spring --skip-listen</code>.</p></div><div class="info"><p>Você pode ver todas as opções de linha de comando que a aplicação Rails
aceita rodando o comando <code>rails new -h</code>.</p></div><p>Depois de criar a aplicação blog, entre em sua pasta:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>blog
</code></pre>
<textarea class="clipboard-content" id="clipboard-845b817b0dad33ee871230e0be0cd3e5">cd blog
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-845b817b0dad33ee871230e0be0cd3e5">Copiar</button>
</div>
<p>A pasta <code>blog</code> tem vários arquivos auto-gerados e pastas que compõem a estrutura
de uma aplicação Rails. A maior parte da execução deste tutorial será feito na
pasta <code>app</code>, mas à seguir teremos um resumo básico das funções de cada um dos arquivos e pastas
que o Rails gerou por padrão:</p>
<table>
<thead>
<tr>
<th>Arquivo/Pasta</th>
<th>Objetivo</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/</td>
<td>Contém os <em>controllers</em>, <em>models</em>, <em>views</em>, <em>helpers</em>, <em>mailers</em>, <em>channels</em>, <em>jobs</em>, e <em>assets</em> para sua aplicação. Você irá se concentrar nesse diretório pelo restante desse guia.</td>
</tr>
<tr>
<td>bin/</td>
<td>Contém o script do Rails que inicializa sua aplicação e contém outros scripts que você utiliza para configurar, atualizar, colocar em produção ou executar sua aplicação.</td>
</tr>
<tr>
<td>config/</td>
<td>Configure as rotas, banco de dados entre outros de sua aplicação. Este conteúdo é abordado com mais detalhes em <a href="configuring.html">Configuring Rails Applications</a>.</td>
</tr>
<tr>
<td>config.ru</td>
<td>Configuração <em>Rack</em> para servidores baseados em <em>Rack</em> usados para iniciar a aplicação. Para mais informações sobre o <em>Rack</em>, consulte <a href="https://rack.github.io/">Rack website</a>.</td>
</tr>
<tr>
<td>db/</td>
<td>Contém o <em>schema</em> do seu banco de dados atual, assim como as <em>migrations</em> do banco de dados.</td>
</tr>
<tr>
<td>Gemfile<br>Gemfile.lock</td>
<td>Esses arquivos permitem que você especifique quais dependências de <em>gem</em> são necessárias na sua aplicação Rails. Esses arquivos são usados pela <em>gem</em> Bundler. Para mais informações sobre o Bundler, acesse <a href="https://bundler.io">o website do Bundler</a>.</td>
</tr>
<tr>
<td>lib/</td>
<td>Módulos extendidos da sua aplicação.</td>
</tr>
<tr>
<td>log/</td>
<td>Arquivos de <em>log</em> da aplicação.</td>
</tr>
<tr>
<td>package.json</td>
<td>Este arquivo permite que você especifique quais dependências <em>npm</em> são necessárias para sua aplicação Rails. Este arquivo é usado pelo Yarn. Para mais informações do Yarn, acesse <a href="https://yarnpkg.com/lang/en/">o website do Yarn</a>.</td>
</tr>
<tr>
<td>public/</td>
<td>O único diretório visto pelo mundo. Contém arquivos estáticos e <em>assets</em> compilados.</td>
</tr>
<tr>
<td>Rakefile</td>
<td>Este arquivo localiza e carrega tarefas que podem ser rodadas por linhas de comando. As tarefas são definidas nos componentes do Rails. Ao invés de editar o <code>Rakefile</code>, você deve criar suas próprias tarefas adicionando os arquivos no diretório <code>lib/tasks</code> da sua aplicação.</td>
</tr>
<tr>
<td>README.md</td>
<td>Este é um manual de instruções para sua aplicação. Você deve editar este arquivo para informar o que seu aplicativo faz, como configurá-lo e assim por diante.</td>
</tr>
<tr>
<td>storage/</td>
<td>Arquivos de armazenamento ativo do serviço de disco. Mais informações em <a href="active_storage_overview.html">Active Storage Overview</a>.</td>
</tr>
<tr>
<td>test/</td>
<td>Testes unitários, <em>fixtures</em>, e outros tipos de testes. Mais informações em <a href="testing.html">Testing Rails Applications</a>.</td>
</tr>
<tr>
<td>tmp/</td>
<td>Arquivos temporários (como cache e arquivos <em>pid</em>).</td>
</tr>
<tr>
<td>vendor/</td>
<td>Diretório com todos os códigos de terceiros. Em uma típica aplicação Rails inclui <em>vendored gems</em>.</td>
</tr>
<tr>
<td>.gitignore</td>
<td>Este arquivo diz ao Git quais arquivos (ou padrões) devem ser ignorados. Acesse <a href="https://help.github.com/articles/ignoring-files">GitHub - Ignoring files</a> para mais informações sobre arquivos ignorados.</td>
</tr>
<tr>
<td>.ruby-version</td>
<td>Este arquivo contém a versão padrão do Ruby.</td>
</tr>
</tbody>
</table>
<h3 id="ola-rails-bang"><a class="anchorlink" href="#ola-rails-bang">4 Olá, Rails!</a></h3><p>Para começar vamos colocar um texto na tela rapidamente. Para fazer isso, você
precisa que seu servidor de aplicação Rails esteja em execução.</p><h4 id="inicializando-o-servidor-web"><a class="anchorlink" href="#inicializando-o-servidor-web">4.1 Inicializando o Servidor Web</a></h4><p>Você já tem uma aplicação Rails funcional. Para vê-la você deve iniciar um
servidor web em sua máquina de desenvolvimento. Você pode fazer isso executando
o seguinte comando no diretório <code>blog</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>server
</code></pre>
<textarea class="clipboard-content" id="clipboard-569b14cc6bbe7df0cee900778aa85907">rails server
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-569b14cc6bbe7df0cee900778aa85907">Copiar</button>
</div>
<div class="info"><p>Se você está usando Windows, deve executar os scripts do diretório
<code>bin</code> para o interpretador do Ruby: <code>ruby bin\rails server</code>.</p></div><div class="info"><p>A compressão de <em>assets</em> JavaScript requer que você tenha um executor
disponível em seu sistema operacional. Na ausência de um executor você verá um
erro de <code>execjs</code> durante a compilação dos <em>assets</em>. Geralmente o macOS e o Windows possuem um executor JavaScript instalado por
padrão. <code>therubyrhino</code> é o executor recomendado para usuários de JRuby e vem no
<code>Gemfile</code> por padrão em aplicações geradas com JRuby. Você pode avaliar todos
executores em <a href="https://github.com/rails/execjs#readme">ExecJS</a>.</p></div><p>A execução do comando irá iniciar o Puma, um servidor web distribuído com o
Rails por padrão. Para ver sua aplicação em execução, abra um navegador e
navegue para <a href="http://localhost:3000">http://localhost:3000</a>.  Você deve ver a página padrão com informações do Rails:</p><p><img src="images/getting_started/rails_welcome.png" alt="Captura de tela escrito Yay! Você está no Rails(em inglês)"></p><div class="info"><p>Para interromper a execução do servidor Web, pressione Ctrl+C na janela do
terminal em que o servidor está sendo executado. Para verificar se o servidor
realmente foi interrompido, você deve ver o cursor do <code>prompt</code> novamente. Para a
maioria dos sistemas baseados em UNIX, incluindo o macOS, o cursor é
representando por um sinal de <code>$</code>. Em modo de desenvolvimento, o Rails
geralmente não exige que você reinicie o servidor; mudanças feitas nos arquivos
da aplicaçnao serão automaticamente aplicadas no servidor.</p></div><p>A página de "Yay! Você está no Rails! (Yay! You're on Rails!)" é o <em>smoke test</em> (teste de sanidade) para uma
nova aplicação Rails: garante que o seu software esteja configurado
corretamente, o suficiente para gerar uma página.</p><h4 id="diga-ola-rails"><a class="anchorlink" href="#diga-ola-rails">4.2 Diga "Olá", Rails</a></h4><p>Para que o Rails diga "Olá", você precisa criar no mínimo um <em>controller</em> e uma
<em>view</em>.</p><p>O objetivo de um <em>controller</em> é receber requisições específicas para a
aplicação. O <em>Routing</em> (roteamento) decide qual <em>controller</em> recebe quais
requisições. Muitas vezes, há mais de uma rota para cada <em>controller</em>, e
diferentes rotas podem ser providas por diferentes <em>actions</em>. O objetivo de cada
<em>action</em> é coletar informações para fornecer para uma <em>view</em>.</p><p>O objetivo de uma <em>view</em> é exibir essas informações em um formato legível para
humanos. Uma diferença importante a ser feita é que é no <em>controller</em>, não na
<em>view</em>, onde as informações são coletadas. A <em>view</em> deve apenas exibir essas
informações. Por padrão, os <em>templates</em> de <em>view</em> são escritos em uma linguagem
chamada eRuby (<em>Embedded Ruby</em>) que é processada pelo ciclo da requisição no
Rail antes de ser enviada para o usuário.</p><p>Para criar um novo <em>controller</em>, você precisará executar o gerador de
<em>controller</em> e informar que você deseja um <em>controller</em> chamado "Welcome"
com uma <em>action</em> chamada "index", exatamente assim:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>generate controller Welcome index
</code></pre>
<textarea class="clipboard-content" id="clipboard-7606cc0b351985dd1388aaa594cd77c4">rails generate controller Welcome index
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7606cc0b351985dd1388aaa594cd77c4">Copiar</button>
</div>
<p>O Rails criará vários arquivos e uma rota para você.</p><div class="code_container">
<pre><code class="highlight console"><span class="go">create  app/controllers/welcome_controller.rb
 route  get 'welcome/index'
invoke  erb
create    app/views/welcome
create    app/views/welcome/index.html.erb
invoke  test_unit
create    test/controllers/welcome_controller_test.rb
invoke  helper
create    app/helpers/welcome_helper.rb
invoke    test_unit
invoke  assets
invoke    scss
create      app/assets/stylesheets/welcome.scss
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-dda0711702455badf4d78ac9e6bde309"></textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-dda0711702455badf4d78ac9e6bde309">Copiar</button>
</div>
<p>Os mais importantes são, certamente, o <em>controller</em>, localizado em
<code>app/controllers/welcome_controller.rb</code> e a <em>view</em>, localizada em
<code>app/views/welcome/index.html.erb</code>.</p><p>Abra o arquivo <code>app/views/welcome/index.html.erb</code> em seu editor de texto. Exclua
todo o código existente no arquivo e substitua pela linha de código abaixo:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;h1&gt;</span>Olá, Rails!<span class="nt">&lt;/h1&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b8ad77c7bc7d8a0e9a815968855c78d5">&lt;h1&gt;Olá, Rails!&lt;/h1&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b8ad77c7bc7d8a0e9a815968855c78d5">Copiar</button>
</div>
<h4 id="configuracao-da-pagina-inicial-da-aplicacao"><a class="anchorlink" href="#configuracao-da-pagina-inicial-da-aplicacao">4.3 Configuração da Página Inicial da Aplicação</a></h4><p>Agora que criamos o <em>controller</em> e a <em>view</em>, precisamos informar ao Rails quando
queremos que "Olá, Rails" seja exibido. No nosso caso, queremos que seja exibido
quando navegarmos para a URL raiz de nosso site, <a href="http://localhost:3000">http://localhost:3000</a>. No
momento, "Yay! Você está no Rails!" é que está preenchendo esse lugar.</p><p>Em seguida, você deve informar ao Rails onde está localizada a sua página
inicial.</p><p>Abra o arquivo <code>config/routes.rb</code> em seu editor de texto.</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'welcome/index'</span>

  <span class="c1"># For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9a0439248fba173ef4faccd2b83c22e9">Rails.application.routes.draw do
  get 'welcome/index'

  # For details on the DSL available within this file, see https://guides.rubyonrails.org/routing.html
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9a0439248fba173ef4faccd2b83c22e9">Copiar</button>
</div>
<p>Este é o arquivo <em>routing</em> (roteamento) da sua aplicação que contém
as entradas em um
<a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL (domain-specific language)</a> especial
que informa ao Rails como conectar requisições de entrada com <em>controllers</em> e
<em>actions</em>.
Edite este arquivo adicionando a linha de código <code>root 'welcome#index'</code>.
Deve ser algo parecido com o seguinte:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'welcome/index'</span>

  <span class="n">root</span> <span class="s1">'welcome#index'</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-154c43fccf2cae7088f81b566f8d73a3">Rails.application.routes.draw do
  get 'welcome/index'

  root 'welcome#index'
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-154c43fccf2cae7088f81b566f8d73a3">Copiar</button>
</div>
<p><code>root 'welcome#index'</code> informa ao Rails para mapear as requisições para a raiz
da aplicação para o <em>controller</em> "welcome", <em>action</em> "index" e <code>get
'welcome/index'</code> informa ao Rails para mapear as requisições para
<a href="http://localhost:3000/welcome/index">http://localhost:3000/welcome/index</a> para o <em>controller</em> "welcome", <em>action</em>
"index". Isso foi criado anteriormente quando você executou o gerador de
<em>controller</em> (<code>rails generate controller Welcome index</code>).</p><p>Inicie o servidor <em>web</em> novamente se você o interrompeu para gerar o <em>controller</em>
(<code>rails server</code>) e navegue até <a href="http://localhost:3000">http://localhost:3000</a> no seu navegador. Você
verá a mensagem "Olá, Rails!", a mesma que você colocou em
<code>app/views/welcome/index.html.erb</code>, indicando que essa nova rota de fato vai
para a <em>action</em> <code>index</code> de <code>WelcomeController</code> e está renderizando a <em>view</em>
corretamente.</p><div class="info"><p>Para mais informações sobre roteamento, consulte <a href="routing.html">Roteamento do Rails de Fora para Dentro</a>.</p></div><h3 id="iniciando-e-executando"><a class="anchorlink" href="#iniciando-e-executando">5 Iniciando e Executando</a></h3><p>Agora que você já viu como criar um <em>controller</em>, uma <em>action</em>, e uma <em>view</em>, vamos criar algo um pouco mais relevante.</p><p>Na aplicação do Blog você irá criar um novo <em>resource</em>. <em>Resource</em> é um termo utilizado para uma coleção de objetos similares, como artigos, pessoas ou animais.
Você pode criar, visualizar, editar e deletar dados de um <em>resource</em> e essas ações são definidas como operações <em>CRUD</em>.</p><p>O Rails te fornece um método <code>resources</code> que pode ser usado para declarar um recurso padrão <em>REST</em>. Você precisa adicionar o <em>article resource</em> no <code>config/routes.rb</code> e o arquivo ficará como a seguir:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'welcome/index'</span>

  <span class="n">resources</span> <span class="ss">:articles</span>

  <span class="n">root</span> <span class="s1">'welcome#index'</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-898c4cd126377b3c8ad48c5f02b8c225">Rails.application.routes.draw do
  get 'welcome/index'

  resources :articles

  root 'welcome#index'
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-898c4cd126377b3c8ad48c5f02b8c225">Copiar</button>
</div>
<p>Se você executar <code>rails routes</code>, você verá que foram definidas rotas para todas as <em>actions</em> padrão <em>RESTful</em>.
O significado do prefixo da coluna (e de outras colunas) será visto mais adiante, mas por enquanto, observe que o Rails entende <code>article</code> de forma singular e faz o uso significativo da distinção.</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>routes
<span class="gp">       Prefix Verb   URI Pattern                  Controller#</span>Action
<span class="gp">welcome_index GET    /welcome/index(.:format)     welcome#</span>index
<span class="gp">     articles GET    /articles(.:format)          articles#</span>index
<span class="gp">              POST   /articles(.:format)          articles#</span>create
<span class="gp">  new_article GET    /articles/new(.:format)      articles#</span>new
<span class="gp"> edit_article GET    /articles/:id/edit(.:format) articles#</span>edit
<span class="gp">      article GET    /articles/:id(.:format)      articles#</span>show
<span class="gp">              PATCH  /articles/:id(.:format)      articles#</span>update
<span class="gp">              PUT    /articles/:id(.:format)      articles#</span>update
<span class="gp">              DELETE /articles/:id(.:format)      articles#</span>destroy
<span class="gp">         root GET    /                            welcome#</span>index
</code></pre>
<textarea class="clipboard-content" id="clipboard-bd7fd021a264760762b3c0e1d6650ae0">rails routes
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-bd7fd021a264760762b3c0e1d6650ae0">Copiar</button>
</div>
<p>Na próxima seção, você adicionará a funcionalidade para criar e visualizar novos artigos (articles) em sua aplicação. Este é o "C" e o "R" do <em>CRUD</em>: <em>create</em> (criação) e <em>read</em> (leitura). O formulário para fazer isso ficará assim:</p><p><img src="images/getting_started/new_article.png" alt="The new article form"></p><p>Por enquanto está um pouco simples, mas tudo bem. Nós iremos melhorar o estilo mais adiante.</p><h4 id="preparando-a-base"><a class="anchorlink" href="#preparando-a-base">5.1 Preparando a base</a></h4><p>Primeiramente, você precisa de um lugar na aplicação para criar um novo artigo. Um ótimo lugar seria em <code>/articles/new</code>. Com a rota já definida, agora é possível fazer requisições para <code>/articles/new</code> na aplicação. Acesse <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> e você verá um erro de rota:</p><p><img src="images/getting_started/routing_error_no_controller.png" alt="Another routing error, uninitialized constant ArticlesController"></p><p>Este erro ocorre porque a rota precisa ter um <em>controller</em> definido para atender à requisição. A solução para esse problema específico é simples: crie um <em>controller</em> chamado <code>ArticlesController</code>. Você pode fazer isso executando este comando:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>generate controller Articles
</code></pre>
<textarea class="clipboard-content" id="clipboard-d69d1ca066c3101e0cb3f3c2f6faa18d">rails generate controller Articles
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d69d1ca066c3101e0cb3f3c2f6faa18d">Copiar</button>
</div>
<p>Se você abrir o recém-criado <code>app/controllers/articles_controller.rb</code>
verá um <em>controller</em> vazio:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ae0271b9630674c46c392631a8183979">class ArticlesController &lt; ApplicationController
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ae0271b9630674c46c392631a8183979">Copiar</button>
</div>
<p>Um <em>controller</em> é uma classe definida para herdar de <code>ApplicationController</code>.
É dentro dessa classe que você define os métodos que se tornarão as ações desse <em>controller</em>. Essas ações executarão operações <em>CRUD</em> nos artigos em nosso sistema.</p><div class="note"><p>Existem métodos <code>public</code>, <code>private</code> e <code>protected</code> no Ruby, mas apenas métodos <code>public</code> podem ser ações nos <em>controllers</em>. Para mais detalhes, consulte  <a href="http://www.ruby-doc.org/docs/ProgrammingRuby/">Programação Ruby</a>.</p></div><p>Se você atualizar <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> agora, receberá um novo erro:</p><p><img src="images/getting_started/unknown_action_new_for_articles.png" alt="Unknown action new for ArticlesController!"></p><p>Este erro indica que o Rails não consegue encontrar a ação <code>new</code> dentro do <code>ArticlesController</code> que você acabou de gerar. Isso ocorre porque quando os <em>controllers</em> são gerados no Rails, eles estão vazios por padrão, a menos que você diga as ações que deseja durante o processo de geração.</p><p>Para definir manualmente uma ação dentro de um <em>controller</em>, tudo o que você precisa fazer é definir um novo método dentro do <em>controller</em>. Abra <code>app/controllers/articles_controller.rb</code> e, dentro da classe <code>ArticlesController</code>, defina o método <code>new</code> para que agora seu <em>controller</em> fique assim:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ee44a82b2f6f86819d0f8dd45926ad57">class ArticlesController &lt; ApplicationController
  def new
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ee44a82b2f6f86819d0f8dd45926ad57">Copiar</button>
</div>
<p>Com o método <code>new</code> definido em <code>ArticlesController</code>, se você atualizar
<a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> verá um outro erro:</p><p><img src="images/getting_started/template_is_missing_articles_new.png" alt="Template is missing for articles/new"></p><p>Você está recebendo esse erro agora porque o Rails espera que <em>actions</em> como esta tenham <em>views</em> associadas a elas para exibir suas informações. Sem uma <em>view</em> disponível, o Rails gerará uma exceção.</p><p>Vamos ver a mensagem de erro completa novamente:</p>
<blockquote>
<p>ArticlesController#new  está faltando um <em>template</em> para o formato da requisição: <em>text/html</em></p>
<p>NOTA!
Como dito, o Rails espera que uma ação renderize um <em>template</em> com o mesmo nome, contido em uma pasta com o nome de seu <em>controller</em>. Se esse <em>controller</em> for uma <em>API</em> que responde com 204 (sem conteúdo), e que não requer um <em>template</em>, então esse erro ocorrerá ao tentar acessá-lo pelo navegador pois esperamos que um <em>template</em> HTML seja renderizado para essas requisições. Se esse for o caso, continue.</p>
</blockquote>
<p>A mensagem identifica qual <em>template</em> está ausente. Nesse caso, é o <em>template</em> <code>articles/new</code>. O Rails procurará primeiro esse <em>template</em>. Se não for encontrado, ele tentará carregar um <em>template</em> chamado <code>application/new</code>, porque o <code>ArticlesController</code> herda do <code>ApplicationController</code>.</p><p>Em seguida, a mensagem contém <code>request.formats</code> que especifica o formato do <em>template</em> a ser exibido em resposta. Ele está definido como <code>text/html</code>, conforme solicitamos esta página pelo navegador, portanto o Rails está procurando um <em>template</em> HTML.</p><p>O <em>template</em> mais simples que funcionaria nesse caso seria o localizado em <code>app/views/articles/new.html.erb</code>. A extensão desse nome de arquivo é importante: a primeira extensão é o formato do <em>template</em> e a segunda extensão é o <em>handler</em> (tratadores) que será usado para renderizar o <em>template</em>. O Rails está tentando encontrar um <em>template</em> chamado <code>articles/new</code> em <code>app/views</code> para a aplicação. O formato para este <em>template</em> pode ser apenas <code>html</code> e o <em>handler</em> padrão para HTML é <code>erb</code>. O Rails usa outros <em>handlers</em> para outros formatos. O <em>handler</em> de <code>builder</code> é usado para criar <em>templates</em> XML e o <em>handler</em> de <code>coffee</code> usa o CoffeeScript para criar <em>templates</em> JavaScript. Como você deseja criar um novo formulário HTML, você usará a linguagem <code>ERB</code> projetada para incorporar Ruby em HTML.</p><p>Portanto, o arquivo deve se chamar <code>articles/new.html.erb</code> e precisa estar localizado dentro do diretório <code>app/views</code> da aplicação.</p><p>Agora vá em frente e crie um novo arquivo em <em>app/views/articles/new.html.erb</em> e escreva este conteúdo:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7512abf7292ac416c9315438c73478ff">&lt;h1&gt;New Article&lt;/h1&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7512abf7292ac416c9315438c73478ff">Copiar</button>
</div>
<p>Ao atualizar <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> você verá que a página tem um título. A rota, o <em>controller</em>, a <em>action</em> e a <em>view</em> estão funcionando harmoniosamente! É hora de criar o formulário para um novo artigo.</p><h4 id="o-primeiro-formulario"><a class="anchorlink" href="#o-primeiro-formulario">5.2 O primeiro formulário</a></h4><p>Para criar um formulário com este template, você vai usar um construtor de formulário (<em>form builder</em>). O construtor de formulários do Rails é disponibilizado por um método <em>helper</em> chamado <code>form_with</code>. Para utilizá-lo, adicione o código abaixo no arquivo <code>app/views/articles/new.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">scope: :article</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span><span class="p">,</span> <span class="s1">'Título'</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:text</span><span class="p">,</span> <span class="s1">'Texto'</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:text</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span><span class="p">,</span> <span class="s1">'Enviar'</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-aa3d0a5d4a80ff8267c6373d108ae1e8">&lt;%= form_with scope: :article, local: true do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :title, 'Título' %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= form.label :text, 'Texto' %&gt;&lt;br&gt;
    &lt;%= form.text_area :text %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= form.submit, 'Enviar' %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-aa3d0a5d4a80ff8267c6373d108ae1e8">Copiar</button>
</div>
<p>Se você atualizar a página, você vai ver o mesmo formulário do nosso exemplo acima.
Construir formulários no Rails é simples assim!</p><p>Quando você chama o <code>form_with</code>, você passa para ele a identificação do escopo para esse formulário.
Neste caso, o <em>symbol</em> <code>:article</code>. Isso mostra ao <code>form_with</code> para qual escopo é o formulário em questão. Dentro do bloco deste método, o objeto <code>FormBuilder</code> - representado pelo <code>form</code> - é usado para construir dois títulos e dois campos textos, um para cada título (<em>labels</em>) e texto (<em>text fields</em>) de um artigo. Finalmente, uma chamada ao <code>submit</code> do objeto <code>form</code> criará um botão de submissão do formulário.</p><p>Porém, existe um problema com este formulário. Se você inspecionar o HTML que foi gerado, visualizando o código-fonte da página, você verá que o atributo <code>action</code> do formulário está apontando para <code>/articles/new</code>. Isso é um problema porque esta rota vai exatamente para a mesma página que você está no momento, e essa rota deveria ser usada apenas para exibir o formulário para um novo artigo.</p><p>O formulário precisa usar uma URL diferente para que consigar ir para outro lugar. Isso pode ser feito de forma simples com a opção <code>:url</code> do <code>form_with</code>. Normalmente, no Rails, a <em>action</em> que é usada para novas submissões de formulários é chamada "create", então o formulário precisa apontar para esta ação.</p><p>Altere a linha do <code>form_with</code> dentro de <code>app/views/articles/new.html.erb</code> para ficar da seguinte forma:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">scope: :article</span><span class="p">,</span> <span class="ss">url: </span><span class="n">articles_path</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8a94c6487d73994f8006dfc70deaf41c">&lt;%= form_with scope: :article, url: articles_path, local: true do |form| %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8a94c6487d73994f8006dfc70deaf41c">Copiar</button>
</div>
<p>Neste exemplo, o <em>helper</em> <code>articles_path</code> é passado para a opção <code>:url</code>.
Para saber o que o Rails fará com isso, veja novamente o resultado do <code>rails routes</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>routes
<span class="gp">      Prefix Verb   URI Pattern                  Controller#</span>Action
<span class="gp">welcome_index GET    /welcome/index(.:format)     welcome#</span>index
<span class="gp">     articles GET    /articles(.:format)          articles#</span>index
<span class="gp">              POST   /articles(.:format)          articles#</span>create
<span class="gp">  new_article GET    /articles/new(.:format)      articles#</span>new
<span class="gp"> edit_article GET    /articles/:id/edit(.:format) articles#</span>edit
<span class="gp">      article GET    /articles/:id(.:format)      articles#</span>show
<span class="gp">              PATCH  /articles/:id(.:format)      articles#</span>update
<span class="gp">              PUT    /articles/:id(.:format)      articles#</span>update
<span class="gp">              DELETE /articles/:id(.:format)      articles#</span>destroy
<span class="gp">         root GET    /                            welcome#</span>index
</code></pre>
<textarea class="clipboard-content" id="clipboard-3ff527c415904af8718373941df46096">rails routes
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3ff527c415904af8718373941df46096">Copiar</button>
</div>
<p>O <em>helper</em> <code>articles_path</code> diz ao Rails para apontar o formulário para o padrão de URI associado com o prefixo <code>articles</code>; e o formulário vai (por padrão) enviar uma requisição <code>POST</code> para esta rota. Isto esta associado com a <em>action</em> <code>create</code> do <code>controller</code> atual, no caso o <code>ArticlesController</code>.</p><p>Com o formulário e sua rota definidos, você será capaz de preencher o formulário e clicar no botão <em>submit</em> para iniciar o processo de criação de um novo artigo, então vá em frente e faça isso. Quando você enviar, você verá um erro familiar:</p><p><img src="images/getting_started/unknown_action_create_for_articles.png" alt="Unknown action create for ArticlesController"></p><p>Agora você precisa adicionar a <em>action</em> <code>create</code> dentro do <code>ArticlesController</code> para que isso funcione.</p><div class="note"><p>Por padrão o <code>form_with</code> submete formulários usando Ajax, evitando assim o redirecionamento da página inteira. Para tornar este guia mais fácil de entender, por ora, nós desabilitamos isso ao utilizar o <code>local: true</code>.</p></div><h4 id="criando-artigos"><a class="anchorlink" href="#criando-artigos">5.3 Criando artigos</a></h4><p>Para fazer este "Unknown action" desaparecer, você pode definir a <em>action</em> <code>create</code> dentro da classe <code>ArticlesController</code> em <code>app/controllers/articles_controller.rb</code>, logo após a <em>action</em> <code>new</code>, como vemos a seguir:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b1179f886d04ef6eb749b55464b40515">class ArticlesController &lt; ApplicationController
  def new
  end

  def create
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b1179f886d04ef6eb749b55464b40515">Copiar</button>
</div>
<p>Se você re-enviar o formulário agora, você ainda não verá nenhuma mudança na página. Não se preocupe!
Isto é porque, por padrão, o Rails retorna a resposta <code>204 No Content</code> para uma <code>action</code> se não especificarmos qual resposta ele deve retornar. Nós apenas adicionamos a <em>action</em> <code>create</code> mas não especificamos nada sobre como a resposta deve ser. Neste caso, a <em>action</em> <code>create</code> deve salvar nosso novo artigo no banco de dados.</p><p>Quando um formulário é enviado, os campos do formulário são enviados ao Rails como <em>parameters</em> (parâmetros). Estes parâmetros podem ser então referenciados dentro das <em>actions</em> do controller, normalmente para executar uma tarefa específica. Para ver como estes parâmetros são, altere a <em>action</em> <code>create</code> para isto:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="n">render</span> <span class="ss">plain: </span><span class="n">params</span><span class="p">[</span><span class="ss">:article</span><span class="p">].</span><span class="nf">inspect</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d1fad061ce29f32324c0253c83d34947">def create
  render plain: params[:article].inspect
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d1fad061ce29f32324c0253c83d34947">Copiar</button>
</div>
<p>O método <code>render</code> está recebendo uma simples <em>hash</em> com a chave <code>:plain</code> e o valor <code>params[:article].inspect</code>. O método <code>params</code> é o objeto que representa os parâmetros (ou campos) enviados pelo formulário. O método <code>params</code> retorna um objeto <code>ActionController::Parameters</code>, que permite você acessar as chaves do <em>hash</em> usando <em>strings</em> ou <em>symbols</em>. Neste caso, os únicos parâmetros que importam são os recebidos pelo formulário.</p><div class="info"><p>Certifique-se de ter um bom entendimento sobre o método <code>params</code>, pois você o usará frequentemente. Vamos considerar uma URL de exemplo: <strong><a href="http://www.example.com/?username=dhh&amp;email=dhh@email.com">http://www.example.com/?username=dhh&amp;email=dhh@email.com</a></strong>. Nesta URL, o <code>params[:username]</code> será igual a "dhh" e o <code>params[:email]</code> será igual a "<a href="mailto:dhh@email.com">dhh@email.com</a>".</p></div><p>Se você reenviar o formulário novamente, você verá algo parecido com isso:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="o">&lt;</span><span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span> <span class="p">{</span><span class="s2">"title"</span><span class="o">=&gt;</span><span class="s2">"First Article!"</span><span class="p">,</span> <span class="s2">"text"</span><span class="o">=&gt;</span><span class="s2">"This is my first article."</span><span class="p">}</span> <span class="ss">permitted: </span><span class="kp">false</span><span class="o">&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-29464be226e889707c600d7ecd22b0ba">&lt;ActionController::Parameters {"title"=&gt;"First Article!", "text"=&gt;"This is my first article."} permitted: false&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-29464be226e889707c600d7ecd22b0ba">Copiar</button>
</div>
<p>A <em>action</em> agora está exibindo os parâmetros para o artigo que estão sendo enviados pelo formulário. Porém, isto não é realmente útil. Sim, você pode ver os parâmetros mas nada em particular está sendo feito com eles.</p><h4 id="criando-um-model-para-o-article-artigo-ingles"><a class="anchorlink" href="#criando-um-model-para-o-article-artigo-ingles">5.4 Criando um  <em>model</em> para o <code>Article</code> (artigo, inglês)</a></h4><p>O <em>model</em>, no rails, utiliza o nome no singular, e a sua tabela correspondente no
banco de dados utiliza o nome no plural. O Rails fornece um gerador para criar
<em>models</em> via linha de comando, o que é utilizado pela maioria das pessoas desenvolvedoras
na hora de criar novos <em>models</em>.</p><p>Para criar um <em>model</em>, execute a linha de comando abaixo:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>generate model Article title:string text:text
</code></pre>
<textarea class="clipboard-content" id="clipboard-5009e6195bafe229f6a395bc4fd16f3a">rails generate model Article title:string text:text
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5009e6195bafe229f6a395bc4fd16f3a">Copiar</button>
</div>
<p>Com esse comando nós dizemos ao Rails que queremos criar um <em>model</em> chamado <code>Article</code>,
com um atributo chamado <em>title</em> do tipo string, e um atributo <em>text</em> do tipo text.
Esses atributos serão automaticamente adicionados à tabela <code>articles</code> no banco de dados,
e mapeadas no <em>model</em> <code>Article</code>.</p><p>O Rails irá criar um monte de arquivos. Por enquanto, nós estamos apenas
interessados no <code>app/models/article.rb</code> e <code>db/migrate/20140120191729_create_articles.rb</code>
(o nome pode ficar um pouco diferente). O último é responsável por criar a estrutura
do banco de dados, o que é a próxima coisa que iremos olhar.</p><div class="info"><p>O <em>Active Record</em> é inteligente o suficiente para automaticamente mapear
o nome das colunas para os atributos do <em>model</em>, o que significa que você
não precisa declará-los dentro do  <em>model</em>, já que o <em>Active Record</em> faz automaticamente.</p></div><h4 id="executando-uma-migration"><a class="anchorlink" href="#executando-uma-migration">5.5 Executando uma <em>Migration</em></a></h4><p>Como acabamos de ver, <code>rails generate model</code> cria um arquivo <em>database migration</em>
no diretório <code>db/migrate</code>. <em>Migrations</em> são classes ruby designadas para simplificar
a criação e modificação de tabelas no banco de dados. O Rails usa
comandos <em>rake</em> para executar a <em>migration</em>, e é possível desfazê-la
depois de ser aplicada ao seu banco de dados. Os nomes dos arquivos das <em>Migrations</em> incluem
um <em>timestamp</em> ("carimbo de hora" em inglês) para assegurar que elas serão processadas
na ordem em que foram criadas.</p><p>Se você olhar no arquivo <code>db/migrate/YYYYMMDDHHMMSS_create_articles.rb</code>
(lembre-se, o seu pode ter o nome um pouco diferente), você encontrará:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CreateArticles</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:articles</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:title</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:text</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-7c5b455eda13f7c95cbfd708dce56558">class CreateArticles &lt; ActiveRecord::Migration[6.0]
  def change
    create_table :articles do |t|
      t.string :title
      t.text :text

      t.timestamps
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7c5b455eda13f7c95cbfd708dce56558">Copiar</button>
</div>
<p>A <em>migration</em> acima cria um método chamado <code>change</code> que será chamado quando esta
<em>migration</em> for executada. A ação definida neste método também é reversível,
o que significa que o Rails sabe como reverter a alteração, caso você queira. Quando você executar esta <em>migration</em>, será
criada uma tabela <code>articles</code> com uma coluna do tipo string e uma coluna do tipo <em>text</em>.
Também serão criados dois campos de <em>timestamp</em>, para permitir que o Rails monitore
quando um <code>Article</code> for criado ou atualizado.</p><div class="info"><p>Para mais informações sobre <em>migrations</em>, veja <a href="active_record_migrations.html">Active Record Migrations</a>.</p></div><p>Agora, você pode usar um comando rails para executar a <em>migration</em>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>db:migrate
</code></pre>
<textarea class="clipboard-content" id="clipboard-6a95fd38b4bedae530d2c0bf29e6ba63">rails db:migrate
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6a95fd38b4bedae530d2c0bf29e6ba63">Copiar</button>
</div>
<p>O Rails irá executar este comando de <em>migration</em> e dizer que a tabela de <code>Articles</code>
foi criada.</p><div class="code_container">
<pre><code class="highlight console"><span class="go">==  CreateArticles: migrating ==================================================
-- create_table(:articles)
</span><span class="gp">   -&gt;</span><span class="w"> </span>0.0019s
<span class="go">==  CreateArticles: migrated (0.0020s) =========================================
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-34f7fb12af4a9c461ed72864e3302a29"></textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-34f7fb12af4a9c461ed72864e3302a29">Copiar</button>
</div>
<div class="note"><p>Por padrão você está trabalhando em ambiente de desenvolvimento,
por este motivo, este comando irá aplicar a <em>migration</em> no banco de dados definido na seção
<code>development</code> do seu arquivo <code>config/database.yml</code>. Se você quiser executar as
<em>migrations</em> em outro ambiente, em produção por exemplo, você deve especificar
quando chamar o comando: <code>rails db:migrate RAILS_ENV=production</code></p></div><h4 id="salvando-dados-no-controller"><a class="anchorlink" href="#salvando-dados-no-controller">5.6 Salvando dados no <em>Controller</em></a></h4><p>De volta no <code>ArticlesController</code>, precisamos alterar a <em>action</em> <code>create</code>
para utilizar o novo <em>model</em> <code>Article</code> para salvar os dados no banco de dados.
Abra <code>app/controllers/articles_controller.rb</code> e altere a <em>action</em> <code>create</code> da
seguinte forma:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article</span><span class="p">])</span>

  <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
  <span class="n">redirect_to</span> <span class="vi">@article</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ced12e53e23e0f760c68b036f8ea4c8c">def create
  @article = Article.new(params[:article])

  @article.save
  redirect_to @article
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ced12e53e23e0f760c68b036f8ea4c8c">Copiar</button>
</div>
<p>O que está acontecendo: todo <em>model</em> Rails pode ser inicializado com seus respectivos
atributos, os quais são automaticamente mapeados para suas respectivas colunas
no banco de dados. Na primeira linha fazemos apenas isso (lembre-se que
<code>params[:article]</code> contém os atributos que estamos interessados). Então,
<code>@article.save</code> é responsável por salvar o <em>model</em> no banco de dados. Finalmente,
redirecionaremos o usuário para <em>action</em> <code>show</code>, que definiremos mais tarde.</p><div class="info"><p>Você deve estar pensando qual o motivo de usar <code>A</code> maiúsculo no <code>Article.new</code>,
quando a maior parte deste guia usou letra minúscula. Neste contexto,
estamos nos referindo a classe <code>Article</code> definida no arquivo <code>app/models/article.rb</code>.
Nome de classe em Ruby deve começar sempre com letra maiúscula.</p></div><div class="info"><p>Como veremos mais tarde, <code>@article.save</code> retorna um booleano
indicando se o <code>article</code> foi salvo ou não.</p></div><p>Se você for agora para <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> você <em>quase</em> será
capaz de criar um <code>article</code>. Tente! Você verá um erro parecido com esse:</p><p><img src="images/getting_started/forbidden_attributes_for_new_article.png" alt="Forbidden attributes for new article"></p><p>O Rails tem diversas <em>features</em> de segurança que te ajudam a construir uma aplicação segura,
e você está lidando com uma delas agora. Esta se chama <a href="action_controller_overview.html#strong-parameters">strong parameters</a> (parâmetros fortes),
que nos obrigam a dizer ao Rails exatamente quais parâmetros estão permitidos
nas <em>actions</em> do <em>controller</em>.</p><p>Por que é necessário? A habilidade de salvar todos os parâmetros do controller no
<em>model</em> de uma só vez deixa o trabalho de quem está programando mais fácil,
mas essa conveniência pode ser utilizada de forma maliciosa. E se um <em>request</em>
para o servidor for trabalhado para fazer parecer um novo formulário de <code>article</code>,
mas também incluir campos extras com valores que violam a integridade da sua aplicação?
Isso possibilitaria a entrada/atribuição de dados ruins no seu <em>model</em> e banco
de dados junto com dados bons - podendo, potencialmente, quebrar sua aplicação ou algo pior.</p><p>Nós definimos quais são os parâmetros permitidos para prevenir atribuições de
dados indesejados. Nesse caso, queremos permitir e exigir os parâmetros <code>title</code>
e <code>text</code> para uso válido do <code>create</code>. A sintaxe para isso utiliza <code>require</code> e
<code>permit</code>. A alteração envolverá uma linha na <em>action</em> <code>create</code>.</p><div class="code_container">
<pre><code class="highlight ruby">  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span><span class="p">))</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a1f812f0782a3e0a864a5e2543f80722">  @article = Article.new(params.require(:article).permit(:title, :text))
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a1f812f0782a3e0a864a5e2543f80722">Copiar</button>
</div>
<p>Frequentemente refatoramos o código para trazer esta alteração para dentro do
seu próprio método, para que possa ser reutilizado por diferentes <em>actions</em> no
mesmo <em>controller</em>, por exemplo <code>create</code> e <code>update</code>. Além do problema de atribuição
de dados inconsistentes, o método frequentemente é colocado como privado, para termos
certeza que não será possível chamá-lo fora do seu contexto. Aqui está o resultado:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

  <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
  <span class="n">redirect_to</span> <span class="vi">@article</span>
<span class="k">end</span>

<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">article_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2a98050edfe3b5fd6e190ddc3dcc8257">def create
  @article = Article.new(article_params)

  @article.save
  redirect_to @article
end

private
  def article_params
    params.require(:article).permit(:title, :text)
  end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2a98050edfe3b5fd6e190ddc3dcc8257">Copiar</button>
</div>
<div class="info"><p>Para mais informações, veja a referência acima e
<a href="https://weblog.rubyonrails.org/2012/3/21/strong-parameters/">este artigo sobre <em>Strong Parameters</em></a>.</p></div><h4 id="mostrando-artigos"><a class="anchorlink" href="#mostrando-artigos">5.7 Mostrando Artigos</a></h4><p>Se você enviar o formulário novamente agora, o Rails reclamará por não encontrar a
<em>action</em> <code>show</code>. Isso não é muito útil, então vamos adicionar a <em>action</em> <code>show</code>
antes de proceder.</p><p>Como vimos na exibição de <code>rails routes</code>, a rota para a <em>action</em><code>show</code> é
do seguinte modo:</p><div class="code_container">
<pre><code class="highlight plaintext">article GET    /articles/:id(.:format)      articles#show
</code></pre>
<textarea class="clipboard-content" id="clipboard-3c545835da72378aeddbe05f2f7380d2">article GET    /articles/:id(.:format)      articles#show
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3c545835da72378aeddbe05f2f7380d2">Copiar</button>
</div>
<p>A sintaxe especial <code>:id</code> diz ao Rails que esta rota espera um parâmetro <code>:id</code>,
que no nosso caso será o id (identificador) do artigo.</p><p>Como fizemos antes, precisamos adicionar a <em>action</em> <code>show</code> no
<code>app/controllers/articles_controller.rb</code> e sua respectiva <em>view</em>.</p><div class="note"><p>Uma prática frequente é colocar as ações CRUD padrão em cada
<em>controller</em> na seguinte ordem: <code>index</code>,<code>show</code>, <code>new</code>,<code>edit</code>, <code>create</code>,<code>update</code>
e <code>destroy</code>. Você pode usar qualquer ordem que escolher, mas lembre-se de que esses
são métodos públicos; conforme mencionado anteriormente neste guia, eles devem ser colocados
antes de declarar visibilidade <code>private</code> no <em>controller</em>.</p></div><p>Dado isso, vamos adicionar a <em>action</em> <code>show</code>, da seguinte maneira:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-56d55fdebde005728b76890fa4280f52">class ArticlesController &lt; ApplicationController
  def show
    @article = Article.find(params[:id])
  end

  def new
  end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-56d55fdebde005728b76890fa4280f52">Copiar</button>
</div>
<p>Algumas coisas a serem observadas. Usamos <code>Article.find</code> para encontrar o artigo que nos
interessa, passando <code>params[:id]</code> para obter o parâmetro <code>:id</code> da requisição.
Também usamos uma variável de instância (prefixada com <code>@</code>) para conter uma
referência ao objeto do artigo. Fazemos isso porque o Rails passará todas as variáveis de instância
para a <em>view</em>.</p><p>Agora, crie um novo arquivo <code>app/views/articles/show.html.erb</code> com o seguinte
conteúdo:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Título:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Texto:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a32d205eba123624ff70d61e438eff6d">&lt;p&gt;
  &lt;strong&gt;Título:&lt;/strong&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Texto:&lt;/strong&gt;
  &lt;%= @article.text %&gt;
&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a32d205eba123624ff70d61e438eff6d">Copiar</button>
</div>
<p>Com essa mudança, você deve finalmente conseguir criar novos artigos.
Visite <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> e faça uma tentativa!</p><p><img src="images/getting_started/show_action_for_articles.png" alt="Imagem mostrando artigos"></p><h4 id="listando-todos-os-artigos"><a class="anchorlink" href="#listando-todos-os-artigos">5.8 Listando todos os artigos</a></h4><p>Nós ainda precisamos de um jeito para listar todos os nossos artigos, então vamos fazer isso.
A rota para isso, conforme apresentado pela execução do comando <code>rails routes</code>, é:</p><div class="code_container">
<pre><code class="highlight plaintext">articles GET    /articles(.:format)          articles#index
</code></pre>
<textarea class="clipboard-content" id="clipboard-4ce1230c61fd0a03af025f9ddbcaadc6">articles GET    /articles(.:format)          articles#index
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4ce1230c61fd0a03af025f9ddbcaadc6">Copiar</button>
</div>
<p>Adicione a <em>action</em> <code>index</code> correspondente a essa rota dentro do
<code>ArticlesController</code> no arquivo <code>app/controllers/articles_controller.rb</code>.
Quando escrevemos uma <em>action</em> <code>index</code>, a prática usual é colocá-lo como
o primeiro método no <em>controller</em>. Vamos fazer isso:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>

</code></pre>
<textarea class="clipboard-content" id="clipboard-8a88bba2dda5f4dbea80a97c02cb04fd">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
  end

</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8a88bba2dda5f4dbea80a97c02cb04fd">Copiar</button>
</div>
<p>E então, finalmente, adicione a <em>view</em> para essa <em>action</em>, localizada em
<code>app/views/articles/index.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Listing Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Title<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Text<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Show'</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-33fd901cb8e49ef1ba940aecdd38f537">&lt;h1&gt;Listing Articles&lt;/h1&gt;

&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
    &lt;th&gt;Text&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
  &lt;/tr&gt;

  &lt;% @articles.each do |article| %&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;%= article.title %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= article.text %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= link_to 'Show', article_path(article) %&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;% end %&gt;
&lt;/table&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-33fd901cb8e49ef1ba940aecdd38f537">Copiar</button>
</div>
<p>Agora se você acessar <a href="http://localhost:3000/articles">http://localhost:3000/articles</a> você verá uma lista de todos os
artigos que você criou.</p><h4 id="adicionando-links"><a class="anchorlink" href="#adicionando-links">5.9 Adicionando links</a></h4><p>Você pode agora criar, mostrar e listar artigos. Agora vamos adicionar links
para navegação pelas páginas.</p><p>Abra o arquivo <code>app/views/welcome/index.html.erb</code> e modifique-o da seguinte maneira:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Olá, Rails!<span class="nt">&lt;/h1&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Meu Blog'</span><span class="p">,</span> <span class="ss">controller: </span><span class="s1">'articles'</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-9c08aae4ac9906497a2a454375416777">&lt;h1&gt;Olá, Rails!&lt;/h1&gt;
&lt;%= link_to 'Meu Blog', controller: 'articles' %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-9c08aae4ac9906497a2a454375416777">Copiar</button>
</div>
<p>O método <code>link_to</code> é um dos <em>view helpers</em> (auxiliares de exibição) internos do Rails. Isso cria um
hiperlink com base no texto a ser exibido e para onde ir - nesse caso, para o caminho
dos artigos.</p><p>Vamos adicionar links para as outras <em>views</em> também, começando com a adição deste
link de "Novo artigo" em <code>app/views/articles/index.html.erb</code>, colocando-o acima da
tag <code>&lt;table&gt;</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Novo artigo'</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d754d00051950deffe547cd5f4d0d5be">&lt;%= link_to 'Novo artigo', new_article_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d754d00051950deffe547cd5f4d0d5be">Copiar</button>
</div>
<p>Este link permitirá abrir o formulário para criar um novo artigo.</p><p>Agora, adicione outro link em <code>app/views/articles/new.html.erb</code>, abaixo do
formulário para retornar à <em>action</em> <code>index</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">scope: :article</span><span class="p">,</span> <span class="ss">url: </span><span class="n">articles_path</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  ...
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Voltar'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-eafabb7a93c7895aea81d3ad3a86798d">&lt;%= form_with scope: :article, url: articles_path, local: true do |form| %&gt;
  ...
&lt;% end %&gt;

&lt;%= link_to 'Voltar', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-eafabb7a93c7895aea81d3ad3a86798d">Copiar</button>
</div>
<p>Por fim, adicione um link à <em>view</em> <code>app/views/articles/show.html.erb</code> para
voltar também à <em>action</em> `index ', assim as pessoas que estão visualizando um único
artigo podem voltar e exibir a lista inteira novamente:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Título:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Texto:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Voltar'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5912b3aa3dad5599bcb581dfe847ad31">&lt;p&gt;
  &lt;strong&gt;Título:&lt;/strong&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Texto:&lt;/strong&gt;
  &lt;%= @article.text %&gt;
&lt;/p&gt;

&lt;%= link_to 'Voltar', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5912b3aa3dad5599bcb581dfe847ad31">Copiar</button>
</div>
<div class="info"><p>Se você deseja vincular a uma <em>action</em> no mesmo <em>controller</em>, não precisa
especificar a opção <code>:controller</code>, pois o Rails usará o <em>controller</em> atual por
padrão.</p></div><div class="info"><p>No modo de desenvolvimento (que é o que você está trabalhando por padrão), o Rails
recarrega sua aplicação com todas as solicitações do navegador, portanto, não é necessário parar
e reiniciar o servidor web quando uma alteração for feita.</p></div><h4 id="adicionando-algumas-validacoes"><a class="anchorlink" href="#adicionando-algumas-validacoes">5.10 Adicionando Algumas Validações</a></h4><p>O arquivo de <em>model</em> <code>app/models/article.rb</code> é o mais simples possível:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-07066334c773bdfaa15bf9edb07ebc46">class Article &lt; ApplicationRecord
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-07066334c773bdfaa15bf9edb07ebc46">Copiar</button>
</div>
<p>Não há muito nesse arquivo - mas observe que a classe <code>Article</code> herda de
<code>ApplicationRecord</code>. <code>ApplicationRecord</code> herda de <code>ActiveRecord::Base</code>
que fornece uma grande funcionalidade aos seus <em>models</em> do Rails gratuitamente,
incluindo operações básicas de CRUD (<em>Create</em> (Criar), <em>Read</em> (Ler), <em>Update</em> (Atualizar), <em>Destroy</em> (Remover)) do banco de dados,
validação de dados, bem como suporte sofisticado à pesquisa e capacidade de relacionar
vários <em>models</em> entre si.</p><p>O Rails inclui métodos para ajudá-lo a validar os dados que você envia aos <em>models</em>.
Abra o arquivo <code>app/models/article.rb</code> e edite-o:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span>
                    <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">5</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-cf021171f486614dcea6891d0ffc7315">class Article &lt; ApplicationRecord
  validates :title, presence: true,
                    length: { minimum: 5 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-cf021171f486614dcea6891d0ffc7315">Copiar</button>
</div>
<p>Essas alterações garantirão que todos os artigos tenham um título com pelo menos cinco
caracteres. O Rails pode validar uma variedade de condições em um <em>model</em>,
incluindo a presença ou exclusividade de colunas, seu formato e a
existência de objetos associados. As validações são abordadas em detalhes em Active
Record Validations](active_record_validations.html).</p><p>Com a validação agora em atividade, quando você chama <code>@article.save</code> em um
artigo inválido, a expressão retornará <code>false</code>. Se você abrir o arquivo
<code>app/controllers/articles_controller.rb</code> novamente, você notará que não
verificamos o resultado da chamada <code>@article.save</code> dentro da <em>action</em> <code>create</code>.
Se <code>@article.save</code> falhar nessa situação, precisamos mostrar o formulário de volta ao
usuário. Para fazer isso, altere as ações <code>new</code> e<code>create</code> dentro
<code>app/controllers/articles_controller.rb</code> para estes:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">new</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

  <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
    <span class="n">redirect_to</span> <span class="vi">@article</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">'new'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">article_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fb72c944823c86426715b30ebe78953a">def new
  @article = Article.new
end

def create
  @article = Article.new(article_params)

  if @article.save
    redirect_to @article
  else
    render 'new'
  end
end

private
  def article_params
    params.require(:article).permit(:title, :text)
  end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fb72c944823c86426715b30ebe78953a">Copiar</button>
</div>
<p>A ação <code>new</code> agora está criando uma nova variável de instância chamada <code>@article</code>, e
você verá por que isso ocorre em apenas alguns momentos.</p><p>Observe que dentro da ação <code>create</code> usamos <code>render</code> em vez de <code>redirect_to</code>
quando o <code>save</code> retorna <code>false</code>. O método <code>render</code> é usado para que o objeto <code>@article</code>
seja enviado de volta para a <em>view</em> <code>new</code> quando ela é renderizada. Esta renderização
é feita dentro da mesma solicitação que o envio do formulário, enquanto o
<code>redirect_to</code> dirá ao navegador para realizar outra solicitação.</p><p>Se você recarregar
<a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a> e
tentar salvar um artigo sem título, o Rails te enviará de volta ao
formulário, mas isso não é muito útil. Você precisa dizer ao usuário que
algo deu errado. Para fazer isso, você pode modificar o arquivo
<code>app/views/articles/new.html.erb</code> para verificar se há mensagens de erro:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">scope: :article</span><span class="p">,</span> <span class="ss">url: </span><span class="n">articles_path</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">any?</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"error_explanation"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">count</span><span class="p">,</span> <span class="s2">"erro"</span><span class="p">)</span> <span class="cp">%&gt;</span> não permitiram
        este artigo de ser salvo:
      <span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;ul&gt;</span>
        <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span><span class="p">,</span> <span class="s1">'Título'</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:text</span><span class="p">,</span> <span class="s1">'Texto'</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:text</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span><span class="p">,</span> <span class="s1">'Enviar'</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Voltar'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-08a3fcf2195afd981ece1e7e87a7ebef">&lt;%= form_with scope: :article, url: articles_path, local: true do |form| %&gt;

  &lt;% if @article.errors.any? %&gt;
    &lt;div id="error_explanation"&gt;
      &lt;h2&gt;
        &lt;%= pluralize(@article.errors.count, "erro") %&gt; não permitiram
        este artigo de ser salvo:
      &lt;/h2&gt;
      &lt;ul&gt;
        &lt;% @article.errors.full_messages.each do |msg| %&gt;
          &lt;li&gt;&lt;%= msg %&gt;&lt;/li&gt;
        &lt;% end %&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;% end %&gt;

  &lt;p&gt;
    &lt;%= form.label :title, 'Título' %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= form.label :text, 'Texto' %&gt;&lt;br&gt;
    &lt;%= form.text_area :text %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= form.submit, 'Enviar' %&gt;
  &lt;/p&gt;

&lt;% end %&gt;

&lt;%= link_to 'Voltar', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-08a3fcf2195afd981ece1e7e87a7ebef">Copiar</button>
</div>
<p>Algumas coisas estão acontecendo. Verificamos se há algum erro com
<code>@article.errors.any?</code> e, nesse caso, mostramos uma lista de todos
erros com <code>@article.errors.full_messages</code>.</p><p><code>pluralize</code> é um auxiliar que recebe um número e uma string como
argumentos. Se o número for maior que um, a sequência será automaticamente
pluralizada.</p><p>A razão pela qual adicionamos <code>@article = Article.new</code> no <code>ArticlesController</code> é
que, caso contrário, <code>@article</code> seria <code>nil</code> em nossa <em>view</em>, e chamar
<code>@article.errors.any?</code> geraria um erro.</p><div class="info"><p>O Rails agrupa automaticamente os campos que contêm um erro com uma div
com a classe <code>field_with_errors</code>. Você pode definir uma regra CSS destacá-los.</p></div><p>Agora você receberá uma boa mensagem de erro ao tentar salvar um artigo sem título no nosso formulário de criação de artigo
<a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>:</p><p><img src="images/getting_started/form_with_errors.png" alt="Form With Errors"></p><h4 id="atualizando-artigos"><a class="anchorlink" href="#atualizando-artigos">5.11 Atualizando Artigos</a></h4><p>Cobrimos a parte "CR" do CRUD. Agora vamos nos concentrar na parte "U", atualizando
artigos.</p><p>O primeiro passo que vamos dar é adicionar uma ação <code>edit</code> ao <code>ArticlesController</code>,
geralmente entre as ações <code>new</code> e<code>create</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">new</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">edit</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

  <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
    <span class="n">redirect_to</span> <span class="vi">@article</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">'new'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-dd462918ac550219c2f2ae4e9be7aa14">def new
  @article = Article.new
end

def edit
  @article = Article.find(params[:id])
end

def create
  @article = Article.new(article_params)

  if @article.save
    redirect_to @article
  else
    render 'new'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-dd462918ac550219c2f2ae4e9be7aa14">Copiar</button>
</div>
<p>A <em>view</em> conterá um formulário semelhante ao que usamos para criar novos artigos.
Crie um arquivo chamado <code>app/views/articles/edit.html.erb</code> e deixe-o como
mostrado em seguida:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Edit Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">any?</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"error_explanation"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">count</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span> <span class="cp">%&gt;</span> prohibited
        this article from being saved:
      <span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;ul&gt;</span>
        <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:text</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:text</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3dd5d823ca5af56ac1bc5b6a53844a83">&lt;h1&gt;Edit Article&lt;/h1&gt;

&lt;%= form_with(model: @article, local: true) do |form| %&gt;

  &lt;% if @article.errors.any? %&gt;
    &lt;div id="error_explanation"&gt;
      &lt;h2&gt;
        &lt;%= pluralize(@article.errors.count, "error") %&gt; prohibited
        this article from being saved:
      &lt;/h2&gt;
      &lt;ul&gt;
        &lt;% @article.errors.full_messages.each do |msg| %&gt;
          &lt;li&gt;&lt;%= msg %&gt;&lt;/li&gt;
        &lt;% end %&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;% end %&gt;

  &lt;p&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= form.label :text %&gt;&lt;br&gt;
    &lt;%= form.text_area :text %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;

&lt;% end %&gt;

&lt;%= link_to 'Back', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3dd5d823ca5af56ac1bc5b6a53844a83">Copiar</button>
</div>
<p>Desta vez, apontamos o formulário para a <em>action</em> <code>update</code>, que ainda não foi
definida, mas em breve será.</p><p>Passar o objeto artigo para o método <code>form_with</code> definirá automaticamente o URL para
enviar o formulário do artigo editado. Esta opção informa ao Rails que o formulário
deve ser enviado pelo método HTTP <code>PATCH</code>, que é o método HTTP que espera ser
utilizado para o <strong>update</strong> dos nossos <em>resources</em> de acordo com o protocolo REST.</p><p>Além disso, passando um <em>model</em> para <code>form_with</code>, como <code>model: @article</code> na
<em>view</em> <em>edit</em> acima, fará com que os <em>helpers</em> do <em>form</em> preencham os campos com
os valores correspondentes do objeto. Passando um <em>symbol</em> de <em>scope</em> como <code>scope: :article</code>,
como foi feito na nova <em>view</em>, apenas exibirá os campos do formulário vazios.
Mais detalhes podem ser encontrados em <a href="https://api.rubyonrails.org/v6.0.3.4/classes/ActionView/Helpers/FormHelper.html#method-i-form_with">Documentação form_with</a>.</p><p>Agora, precisamos criar a <em>action</em> <code>update</code> no <em>controller</em>
<code>app/controllers/articles_controller.rb</code>.
Adicione-a entre os metodos <code>create</code> e <code>private</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

  <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
    <span class="n">redirect_to</span> <span class="vi">@article</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">'new'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">update</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

  <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="vi">@article</span>
  <span class="k">else</span>
    <span class="n">render</span> <span class="s1">'edit'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">article_params</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2ccdc5562d12137b5d45edde42c686cc">def create
  @article = Article.new(article_params)

  if @article.save
    redirect_to @article
  else
    render 'new'
  end
end

def update
  @article = Article.find(params[:id])

  if @article.update(article_params)
    redirect_to @article
  else
    render 'edit'
  end
end

private
  def article_params
    params.require(:article).permit(:title, :text)
  end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2ccdc5562d12137b5d45edde42c686cc">Copiar</button>
</div>
<p>O novo método, <code>update</code>, é usado quando você deseja atualizar um registro
que já existe, ele aceita um hash contendo os atributos que você deseja atualizar.
Como antes, se houve um erro ao atualizar o artigo, queremos mostrar o
formulário de volta ao usuário.</p><p>Nós podemos reutilizar o método <code>article_params</code> que definimos anteriormente
para a <em>action</em> <em>create</em></p><div class="info"><p>Não é necessário passar todos os atributos para o <code>update</code>. Por exemplo,
se <code>@article.update(title: 'A new title')</code> for chamado, o Rails vai apenas
atualizar o atributo <code>title</code>, deixando todos os outros atrubutos como estavam.</p></div><p>Finalmente, nós queremos mostrar o <em>link</em> para a <em>action <code>edit</code></em> na lista dos
artigos, então vamos adiciona-lo agora no arquivo
<code>app/views/articles/index.html.erb</code> para aparecer logo após o <em>link</em> de "Show":</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Title<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Text<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">&gt;&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Show'</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6703e173bbaeb30825db87d05bfbb2cc">&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
    &lt;th&gt;Text&lt;/th&gt;
    &lt;th colspan="2"&gt;&lt;/th&gt;
  &lt;/tr&gt;

  &lt;% @articles.each do |article| %&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;%= article.title %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= article.text %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= link_to 'Show', article_path(article) %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= link_to 'Edit', edit_article_path(article) %&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;% end %&gt;
&lt;/table&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6703e173bbaeb30825db87d05bfbb2cc">Copiar</button>
</div>
<p>E também iremos adicionar em <code>app/views/articles/show.html.erb</code>, assim podemos
ter um <em>link</em> para "Edit" na página de um artigo. Adicione no fim do seu modelo:</p><div class="code_container">
<pre><code class="highlight erb">...

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span> |
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-144047838396715416e561c98159fa98">...

&lt;%= link_to 'Edit', edit_article_path(@article) %&gt; |
&lt;%= link_to 'Back', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-144047838396715416e561c98159fa98">Copiar</button>
</div>
<p>E aqui como nossa aplicação está até agora:</p><p><img src="images/getting_started/index_action_with_edit_link.png" alt="Índice action com link edit"></p><h4 id="usando-partials-para-limpar-duplicacoes-em-views"><a class="anchorlink" href="#usando-partials-para-limpar-duplicacoes-em-views">5.12 Usando <em>partials</em> para limpar duplicações em <em>views</em></a></h4><p>Nossa página <code>edit</code> se parece muito com a página <code>new</code>; na verdade,
ambas compartilham o mesmo código para exibir o formulário. Vamos remover esta
duplicação usando uma <em>view</em> <em>partial</em>. Por convenção, arquivos de <em>partials</em>
são prefixados com um <em>underline</em>.</p><div class="info"><p>Você pode ler mais sobre <em>partials</em> no
guia <a href="layouts_and_rendering.html">Layouts e Renderização no Rails</a>.</p></div><p>Crie um novo arquivo <code>app/views/articles/_form.html.erb</code> com o conteudo a
seguir:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@article</span><span class="p">,</span> <span class="ss">local: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>

  <span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">any?</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"error_explanation"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">pluralize</span><span class="p">(</span><span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">count</span><span class="p">,</span> <span class="s2">"error"</span><span class="p">)</span> <span class="cp">%&gt;</span> prohibited
        this article from being saved:
      <span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;ul&gt;</span>
        <span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">msg</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:text</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:text</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-aaa5c2e6d325bd666532cd68170fc3e0">&lt;%= form_with model: @article, local: true do |form| %&gt;

  &lt;% if @article.errors.any? %&gt;
    &lt;div id="error_explanation"&gt;
      &lt;h2&gt;
        &lt;%= pluralize(@article.errors.count, "error") %&gt; prohibited
        this article from being saved:
      &lt;/h2&gt;
      &lt;ul&gt;
        &lt;% @article.errors.full_messages.each do |msg| %&gt;
          &lt;li&gt;&lt;%= msg %&gt;&lt;/li&gt;
        &lt;% end %&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;% end %&gt;

  &lt;p&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= form.label :text %&gt;&lt;br&gt;
    &lt;%= form.text_area :text %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;

&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-aaa5c2e6d325bd666532cd68170fc3e0">Copiar</button>
</div>
<p>Tudo exceto a declaração <code>form_with</code> permaneceu igual.
A razão pela qual podemos usar a declaração <code>form_with</code> mais curta e simples
para substituir qualquer outro formulário é que <code>@article</code> é um <em>resource</em>
correspondente a um conjunto completo de rotas RESTful, e o Rails pode inferir
qual URI e método a ser usado.
Para obter mais informações sobre esse uso do <code>form_with</code>, consulte
<a href="https://api.rubyonrails.org/v6.0.3.4/classes/ActionView/Helpers/FormHelper.html#method-i-form_with-label-Resource-oriented+style">Estilo orientado a recursos</a>.</p><p>Agora, vamos atualizar a <em>view</em> <code>app/views/articles/new.html.erb</code> para usar a
nova <em>partial</em>, reescrevendo-a completamente:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'form'</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1af8d629eb9ba759c77713597e7fdd0a">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= render 'form' %&gt;

&lt;%= link_to 'Back', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1af8d629eb9ba759c77713597e7fdd0a">Copiar</button>
</div>
<p>Depois, faremos o mesmo em <code>app/views/articles/edit.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Edit Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'form'</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-05b14d6f5582d828817dba7f70bcd60f">&lt;h1&gt;Edit Article&lt;/h1&gt;

&lt;%= render 'form' %&gt;

&lt;%= link_to 'Back', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-05b14d6f5582d828817dba7f70bcd60f">Copiar</button>
</div>
<h4 id="deletando-artigos"><a class="anchorlink" href="#deletando-artigos">5.13 Deletando Artigos</a></h4><p>Nós estamos prontos para cobrir a parte "D" de um CRUD, remover artigos da base
de dados. Seguindo a convenção REST, a rota para deletar artigos, de acordo com
o retorno do comando <code>rails routes</code> é:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">DELETE</span> <span class="sr">/articles/</span><span class="err">:</span><span class="sr">i</span><span class="n">d</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">articles</span><span class="c1">#destroy</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8b8cf7480a824ad72441c8fd7db4e356">DELETE /articles/:id(.:format)      articles#destroy
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8b8cf7480a824ad72441c8fd7db4e356">Copiar</button>
</div>
<p>O método <code>delete</code> roteado deve ser usado para rotas que destroem recursos. Se
esta ação for deixada em uma simples rota <code>get</code>, pode ser possível que pessoas
criem urls maliciosas como esta:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'http://example.com/articles/1/destroy'</span><span class="nt">&gt;</span>look at this cat!<span class="nt">&lt;/a&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-243f137075bb2ba38bb2373397c4979c">&lt;a href='http://example.com/articles/1/destroy'&gt;look at this cat!&lt;/a&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-243f137075bb2ba38bb2373397c4979c">Copiar</button>
</div>
<p>Utilizamos o método <code>delete</code> para destruir recursos, e essa rota é mapeada
à ação <code>destroy</code> dentro de<code>app/controllers/articles_controller.rb</code>, que
ainda não existe. O método <code>destroy</code> é geralmente a última ação CRUD no
o <code>controller</code> e, como as outras ações públicas de CRUD, ele deve ser colocado
antes de qualquer método <code>private</code> ou<code>protected</code>. Vamos adicioná-lo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">destroy</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="vi">@article</span><span class="p">.</span><span class="nf">destroy</span>

  <span class="n">redirect_to</span> <span class="n">articles_path</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1fb1e20a1cf0cb6881783110dbad5872">def destroy
  @article = Article.find(params[:id])
  @article.destroy

  redirect_to articles_path
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1fb1e20a1cf0cb6881783110dbad5872">Copiar</button>
</div>
<p>O <code>ArticlesController</code> completo em <code>app/controllers/articles_controller.rb</code> se
parece com isso:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'new'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="s1">'edit'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="vi">@article</span><span class="p">.</span><span class="nf">destroy</span>

    <span class="n">redirect_to</span> <span class="n">articles_path</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4196561eb8f9283c2156bfd5e033dd96">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def edit
    @article = Article.find(params[:id])
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render 'new'
    end
  end

  def update
    @article = Article.find(params[:id])

    if @article.update(article_params)
      redirect_to @article
    else
      render 'edit'
    end
  end

  def destroy
    @article = Article.find(params[:id])
    @article.destroy

    redirect_to articles_path
  end

  private
    def article_params
      params.require(:article).permit(:title, :text)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4196561eb8f9283c2156bfd5e033dd96">Copiar</button>
</div>
<p>Você pode chamar o <code>destroy</code> nos objetos do <em>Active Record</em> quando desejar excluí-los
do banco de dados. Observe que não precisamos adicionar uma visualização para esta
<em>action</em>, pois estamos redirecionando para a ação <code>index</code>.</p><p>Por fim, adicione um link "Destroy" no <em>template</em> da sua <em>action</em> <code>index</code>
(<code>app/views/articles/index.html.erb</code>) para agrupar todos juntos.</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Listing Articles<span class="nt">&lt;/h1&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'New article'</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Title<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Text<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th</span> <span class="na">colspan=</span><span class="s">"3"</span><span class="nt">&gt;&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Show'</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Destroy'</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">),</span>
              <span class="ss">method: :delete</span><span class="p">,</span>
              <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s1">'Are you sure?'</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-38db713467f852dd5d273d5704fd5c04">&lt;h1&gt;Listing Articles&lt;/h1&gt;
&lt;%= link_to 'New article', new_article_path %&gt;
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
    &lt;th&gt;Text&lt;/th&gt;
    &lt;th colspan="3"&gt;&lt;/th&gt;
  &lt;/tr&gt;

  &lt;% @articles.each do |article| %&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;%= article.title %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= article.text %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= link_to 'Show', article_path(article) %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= link_to 'Edit', edit_article_path(article) %&gt;&lt;/td&gt;
      &lt;td&gt;&lt;%= link_to 'Destroy', article_path(article),
              method: :delete,
              data: { confirm: 'Are you sure?' } %&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;% end %&gt;
&lt;/table&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-38db713467f852dd5d273d5704fd5c04">Copiar</button>
</div>
<p>Aqui estamos usando o <code>link_to</code> de uma maneira diferente. Passamos a rota nomeada como
segundo argumento e, em seguida, as opções como outro argumento. As opções
<code>method: :delete</code> e <code>data: { confirm: 'Are you sure?' }</code> são usadas como
atributos HTML5, portanto quando o link é clicado, o Rails primeiro mostra uma
caixa de diálogo de confirmação para o usuário e, em seguida, envia o link com
o método <code>delete</code>. Isso é feito através do Arquivo JavaScript <code>rails-ujs</code>,
que é automaticamente incluído no <em>layout</em> da aplicação
(<code>app/views/layouts/application.html.erb</code>) quando foi gerado.
Sem esse arquivo, a caixa de diálogo de confirmação não será exibida.</p><p><img src="images/getting_started/confirm_dialog.png" alt="Dialogo de Confirmação"></p><div class="info"><p>Aprenda mais sobre JavaScript discreto no guia
<a href="working_with_javascript_in_rails.html">Trabalhando Com JavaScript Com Rails</a>.</p></div><p>Parabêns, agora você pode criar, mostrar, listar, atualizar e destruir artigos.
Congratulations, you can now create, show, list, update, and destroy
articles.</p><div class="info"><p>Em geral, o Rails encoraja usar o método <code>resources</code> em objetos, ao invés de
declarar as rotas manualmente. Para mais informação sobre roteamento, veja
<a href="routing.html">Roteamento do Rails de Dentro à Fora</a>.</p></div><h3 id="adicionando-um-segundo-model"><a class="anchorlink" href="#adicionando-um-segundo-model">6 Adicionando um Segundo Model</a></h3><p>É hora de adicionar um segundo <em>model</em> à aplicação. O segundo <em>model</em> vai lidar com
comentários em artigos.</p><h4 id="gerando-um-model"><a class="anchorlink" href="#gerando-um-model">6.1 Gerando um Model</a></h4><p>Nós veremos o mesmo <em>generator</em> que usamos antes quando criamos o <em>model</em>
<code>Article</code> (artigo, inglês). Desta vez vamos criar um <em>model</em> <code>Comment</code> (comentário)
que contém a referência para um artigo. Rode esse comando no seu terminal:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>generate model Comment commenter:string body:text article:references
</code></pre>
<textarea class="clipboard-content" id="clipboard-d49339c679070ca475cda314db407312">rails generate model Comment commenter:string body:text article:references
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d49339c679070ca475cda314db407312">Copiar</button>
</div>
<p>Este comando vai gerar quatro arquivos:</p>
<table>
<thead>
<tr>
<th>Arquivo</th>
<th>Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td>db/migrate/20140120201010_create_comments.rb</td>
<td>
<em>Migration</em> para criar a tabela de comentários no seu banco de dados (o nome incluirá um <em>timestamp</em> diferente)</td>
</tr>
<tr>
<td>app/models/comment.rb</td>
<td>O <em>model</em> Comment</td>
</tr>
<tr>
<td>test/models/comment_test.rb</td>
<td>Aparelhagem de testes para o <em>model</em> de comentário</td>
</tr>
<tr>
<td>test/fixtures/comments.yml</td>
<td>Exemplo de comentários para uso em testes</td>
</tr>
</tbody>
</table>
<p>Primeiro, veja o arquivo <code>app/models/comment.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f5cbf31540c8c3f2b0f657d3a89fd79f">class Comment &lt; ApplicationRecord
  belongs_to :article
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f5cbf31540c8c3f2b0f657d3a89fd79f">Copiar</button>
</div>
<p>Isso é muito semelhante ao <em>model</em> <code>Article</code> que vimos antes. A diferença está na
linha <code>belongs_to : article</code>, o que configura uma associação no <em>Active Record</em>.
Você vai aprender um pouco sobre associações na próxima seção deste guia.</p><p>A palavra-chave (<code>:references</code>) usada no comando <code>bash</code> é um tipo especial de
dado para <em>models</em>. Ela cria uma nova coluna na tabela do banco de dados com o
nome fornecido ao <em>model</em> anexada a um <code>_id</code> que contém um valor do tipo
<em>integer</em>. Para compreender melhor, analise o arquivo <code>db/schema.rb</code> depois de
rodar a <em>migration</em>.</p><p>Além do <em>model</em>, o Rails também gerou a <em>migration</em> para criar a tabela
correspondente no banco de dados:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CreateComments</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:comments</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:commenter</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:body</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:article</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="kp">true</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a5505d0137e65ca5585428cf0793ffac">class CreateComments &lt; ActiveRecord::Migration[6.0]
  def change
    create_table :comments do |t|
      t.string :commenter
      t.text :body
      t.references :article, null: false, foreign_key: true

      t.timestamps
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a5505d0137e65ca5585428cf0793ffac">Copiar</button>
</div>
<p>A linha <code>t.references</code> cria uma coluna com valores do tipo <em>integer</em> chamada
<code>article_id</code>, um índice para ela e uma restrição de chave estrangeira (<em>foreign key</em>)
que aponta para a coluna <code>id</code> da tabela <code>articles</code>. Vá em frente e rode a
<em>migration</em>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>db:migrate
</code></pre>
<textarea class="clipboard-content" id="clipboard-54fe6b162fa5a05ae79b20e8877c4aae">rails db:migrate
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-54fe6b162fa5a05ae79b20e8877c4aae">Copiar</button>
</div>
<p>O Rails é inteligente o suficiente para executar somente as migrações que ainda
não foram rodadas no banco de dados atual, assim neste caso você verá:</p><div class="code_container">
<pre><code class="highlight console"><span class="go">==  CreateComments: migrating =================================================
-- create_table(:comments)
</span><span class="gp">   -&gt;</span><span class="w"> </span>0.0115s
<span class="go">==  CreateComments: migrated (0.0119s) ========================================
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-8e8653829e9f596be029766aee067d10"></textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8e8653829e9f596be029766aee067d10">Copiar</button>
</div>
<h4 id="associando-models"><a class="anchorlink" href="#associando-models">6.2 Associando Models</a></h4><p>Associações do <em>Active Record</em> permitem declarar facilmente a relação entre dois
<em>models</em>. No caso de comentários e artigos, você poderia descrever a relação
da seguinte maneira:</p>
<ul>
<li>Cada comentário pertece a um artigo.</li>
<li>Um artigo pode possuir muitos comentários.</li>
</ul>
<p>De fato, essa sintaxe é muito similar à utilizada pelo Rails para declarar essa
associação. Você já viu a linha de código dentro do <em>model</em> <code>Comment</code>
(<code>app/models/comment.rb</code>) que faz com que cada comentário pertença a um Artigo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fd40250a17c7debee14bdc2da559fda0">class Comment &lt; ApplicationRecord
  belongs_to :article
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fd40250a17c7debee14bdc2da559fda0">Copiar</button>
</div>
<p>Você vai precisar editar o arquivo <code>app/models/article.rb</code> para adicionar o outro lado da
associação:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span>
                    <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">5</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-af9d599ed0d3fcfbd27bbbe51a92ebc1">class Article &lt; ApplicationRecord
  has_many :comments
  validates :title, presence: true,
                    length: { minimum: 5 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-af9d599ed0d3fcfbd27bbbe51a92ebc1">Copiar</button>
</div>
<p>Estas duas declarações habilitam uma boa parte de comportamento automático. Por
exemplo, se você possui uma instância da variável <code>@article</code> que contém um
artigo, você pode recuperar todos os comentários pertencentes àquele artigo na
forma de um <em>array</em> usando <code>@article.comments</code>.</p><div class="info"><p>Para mais informações sobre associações do <em>Active Record</em>, veja o guia
<a href="association_basics.html">Associações no Active Record</a>.</p></div><h4 id="adicionando-a-rota-para-comentarios"><a class="anchorlink" href="#adicionando-a-rota-para-comentarios">6.3 Adicionando a Rota para Comentários</a></h4><p>Da mesma forma que o <em>controller</em> <code>welcome</code>, nós vamos precisar adicionar a
rota para que o Rails saiba para onde queremos navegar para encontrar
<code>comments</code>. Abra o arquivo <code>config/routes.rb</code> novamente e o edite da seguinte
maneira:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-05db5fb0cecdec95eae696f967d171de">resources :articles do
  resources :comments
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-05db5fb0cecdec95eae696f967d171de">Copiar</button>
</div>
<p>Isso cria <code>comments</code> como um recurso aninhado (<em>nested resource</em>) dentro de <code>article</code>. Essa é
outra parte do processo para recuperar as relações hierárquicas que existem  entre
artigos e comentários.</p><div class="info"><p>Para mais informações sobre rotas, veja o guia <a href="routing.html">Roteamento no Rails</a></p></div><h4 id="gerando-um-controller"><a class="anchorlink" href="#gerando-um-controller">6.4 Gerando um Controller</a></h4><p>Com o <em>model</em> em mãos, você pode voltar sua atenção para a criação do
<em>controller</em> correspondente. Mais uma vez, você vai usar o <em>generator</em> usado
anteriormente:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>generate controller Comments
</code></pre>
<textarea class="clipboard-content" id="clipboard-34b310e12f609537baf4a3e6af9ae754">rails generate controller Comments
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-34b310e12f609537baf4a3e6af9ae754">Copiar</button>
</div>
<p>Isso cria quatro arquivos e um diretório vazio:</p>
<table>
<thead>
<tr>
<th>Arquivo/Diretório</th>
<th>Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/controllers/comments_controller.rb</td>
<td>O <em>controller</em> de comentários</td>
</tr>
<tr>
<td>app/views/comments/</td>
<td>
<em>Views</em> do <em>controller</em> são armazenadas aqui</td>
</tr>
<tr>
<td>test/controllers/comments_controller_test.rb</td>
<td>O teste para o <em>controller</em>
</td>
</tr>
<tr>
<td>app/helpers/comments_helper.rb</td>
<td>Arquivo de <em>helpers</em> da <em>view</em>
</td>
</tr>
<tr>
<td>app/assets/stylesheets/comments.scss</td>
<td>
<em>Cascading style sheet</em> (CSS) para o <em>controller</em>
</td>
</tr>
</tbody>
</table>
<p>Como em qualquer blog, nossos leitores vão criar seus comentários diretamente
depois de lerem o artigo e, uma vez que adicionarem o comentário, serão enviados
de volta para a página <em>show</em> do artigo para verem o comentário agora listado.
Por essa razão, nosso <code>CommentsController</code> está aqui para fornecer um método que
cria comentários e deleta comentários <em>spam</em> quando chegarem.</p><p>Então, primeiro nós vamos ligar o <em>show template</em> para Artigos (<code>app/views/articles/show.html.erb</code>)
para que possamos criar um novo comentários:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Title:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Text:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">],</span> <span class="ss">local: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span> |
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-978ca3f28f5395bb3ee8b333258a301f">&lt;p&gt;
  &lt;strong&gt;Title:&lt;/strong&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Text:&lt;/strong&gt;
  &lt;%= @article.text %&gt;
&lt;/p&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with(model: [ @article, @article.comments.build ], local: true) do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

&lt;%= link_to 'Edit', edit_article_path(@article) %&gt; |
&lt;%= link_to 'Back', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-978ca3f28f5395bb3ee8b333258a301f">Copiar</button>
</div>
<p>Isso adiciona na página <em>show</em> do <code>Article</code> um formulário que cria um novo
comentário chamando a <em>action</em> <code>create</code> no <code>CommentsController</code>. O <code>form_with</code>
aqui usa um <em>array</em> que vai construir uma rota aninhada, como <code>/articles/1/comments</code>.</p><p>Vamos ligar a <em>action</em> <code>create</code> em <code>app/controllers/comments_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6e9f626fcea4b7860976272f0e718979">class CommentsController &lt; ApplicationController
  def create
    @article = Article.find(params[:article_id])
    @comment = @article.comments.create(comment_params)
    redirect_to article_path(@article)
  end

  private
    def comment_params
      params.require(:comment).permit(:commenter, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6e9f626fcea4b7860976272f0e718979">Copiar</button>
</div>
<p>Você verá um pouco mais de complexidade aqui do que no <em>controller</em> para
artigos. Esse é o efeito colateral do aninhamento que você configurou. Cada
requisição para um comentário deve lembrar o artigo ao qual o comentário está
anexado, para que a chamada inicial do método <code>find</code> do <em>model</em> <code>Article</code>
encontre o artigo em questão.</p><p>Além disso, o código aproveita-se de alguns métodos disponíveis para uma
associação. Nós usamos o método <code>create</code> em <code>@article.comments</code> para criar e
salvar um comentário. Isso vai automaticamente conectar o comentário para que
ele pertença àquele artigo em particular.</p><p>Uma vez que temos um novo comentário, nós enviamos o usuário de volta ao artigo
original usando o helper <code>article_path(@article)</code>. Como já vimos
anteriormente, isso chama a <em>action</em> <code>show</code> do <code>ArticlesController</code> que por sua
vez renderiza o <em>template</em> <code>show.html.erb</code>. É aqui que queremos que o comentário
apareça, então vamos adicionar isso ao arquivo <code>app/views/articles/show.html.erb</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Title:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Text:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">],</span> <span class="ss">local: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span> |
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-39d7d5a076bc160db980c08649468960">&lt;p&gt;
  &lt;strong&gt;Title:&lt;/strong&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Text:&lt;/strong&gt;
  &lt;%= @article.text %&gt;
&lt;/p&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;% @article.comments.each do |comment| %&gt;
  &lt;p&gt;
    &lt;strong&gt;Commenter:&lt;/strong&gt;
    &lt;%= comment.commenter %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;strong&gt;Comment:&lt;/strong&gt;
    &lt;%= comment.body %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with(model: [ @article, @article.comments.build ], local: true) do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

&lt;%= link_to 'Edit', edit_article_path(@article) %&gt; |
&lt;%= link_to 'Back', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-39d7d5a076bc160db980c08649468960">Copiar</button>
</div>
<p>Agora podemos adicionar artigos e comentários ao seu blog e mostrá-los nos
lugares certos.</p><p><img src="images/getting_started/article_with_comments.png" alt="Article with Comments"></p><h3 id="refatorando"><a class="anchorlink" href="#refatorando">7 Refatorando</a></h3><p>Agora que nossos artigos e comentários funcionam, dê uma olhada no template
<code>app/views/articles/show.html.erb</code>. Ele está ficando longo e esquisito. Nós
podemos usar <em>partials</em> (<em>views</em> parciais) para melhorá-lo.</p><h4 id="renderizando-colecoes-de-partials"><a class="anchorlink" href="#renderizando-colecoes-de-partials">7.1 Renderizando Coleções de <em>Partials</em></a></h4><p>Primeiramente, nós vamos criar uma <em>partial</em> para extrair a exibição de todos os
comentários para o artigo. Crie o arquivo <code>app/views/comments/_comment.html.erb</code>
e insira o código a seguir:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3a668d5649c31cfae7a380aad1a0c4d4">&lt;p&gt;
  &lt;strong&gt;Commenter:&lt;/strong&gt;
  &lt;%= comment.commenter %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Comment:&lt;/strong&gt;
  &lt;%= comment.body %&gt;
&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3a668d5649c31cfae7a380aad1a0c4d4">Copiar</button>
</div>
<p>Então você pode mudar <code>app/views/articles/show.html.erb</code> para o seguinte código:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Title:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Text:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">],</span> <span class="ss">local: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span> |
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5957c5c0e8627128bd4178897f68b426">&lt;p&gt;
  &lt;strong&gt;Title:&lt;/strong&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Text:&lt;/strong&gt;
  &lt;%= @article.text %&gt;
&lt;/p&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with(model: [ @article, @article.comments.build ], local: true) do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

&lt;%= link_to 'Edit', edit_article_path(@article) %&gt; |
&lt;%= link_to 'Back', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5957c5c0e8627128bd4178897f68b426">Copiar</button>
</div>
<p>Isso fará com que a <em>partial</em> seja renderizada em <code>app/views/comments/_comment.html.erb</code>
uma vez para cada comentário na coleção <code>@article.comments</code>. Como o método
<code>render</code> itera sobre a coleção <code>@article.comments</code>, ele designa cada comentário
para uma variável local nomeada como a <em>partial</em>, nesse caso <code>comment</code>, que então
fica disponível para ser exibida na <em>partial</em>.</p><h4 id="renderizando-um-formulario-com-partial"><a class="anchorlink" href="#renderizando-um-formulario-com-partial">7.2 Renderizando um Formulário com <em>Partial</em></a></h4><p>Agora vamos mover aquela nova seção de comentários para sua própria <em>partial</em>.
Novamente, crie o arquivo <code>app/viewscomments/_form.html.erb</code> contendo:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">],</span> <span class="ss">local: </span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-03957c8b1d65ae756ce55392f5452bc6">&lt;%= form_with(model: [ @article, @article.comments.build ], local: true) do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-03957c8b1d65ae756ce55392f5452bc6">Copiar</button>
</div>
<p>Então deixe o arquivo <code>app/views/articles/show.html.erb</code> assim:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Title:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Text:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">text</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'comments/form'</span> <span class="cp">%&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Edit'</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span> |
<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Back'</span><span class="p">,</span> <span class="n">articles_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-031cd0bc88ded1b7192e25a0c2869741">&lt;p&gt;
  &lt;strong&gt;Title:&lt;/strong&gt;
  &lt;%= @article.title %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Text:&lt;/strong&gt;
  &lt;%= @article.text %&gt;
&lt;/p&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= render 'comments/form' %&gt;

&lt;%= link_to 'Edit', edit_article_path(@article) %&gt; |
&lt;%= link_to 'Back', articles_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-031cd0bc88ded1b7192e25a0c2869741">Copiar</button>
</div>
<p>O segundo <em>render</em> apenas define o template de <em>partial</em> que queremos renderizar,
<code>comments/form</code>. O Rails é inteligente o suficiente para entender a barra nessa
string e perceber que você quer renderizar o arquivo <code>_form.html.erb</code> no
diretório <code>app/views/comments</code>.</p><p>O objeto <code>@article</code> está disponível para todas as <em>partials</em> renderizadas na view
porque o definimos como uma variável de instância.</p><h3 id="deletando-comentarios"><a class="anchorlink" href="#deletando-comentarios">8 Deletando Comentários</a></h3><p>Outra importante <em>feature</em> de um blog é excluir comentários de spam. Para fazer
isto, nós precisamos implementar um link de alguma <em>view</em> e uma <em>action</em>
<code>destroy</code> no <code>CommentsController</code>.</p><p>Primeiro, vamos adicionar o link <em>delete</em> na <em>partial</em>
<code>app/views/comments/_comment.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Autor do comentário:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comentário:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Destruir comentário'</span><span class="p">,</span> <span class="p">[</span><span class="n">comment</span><span class="p">.</span><span class="nf">article</span><span class="p">,</span> <span class="n">comment</span><span class="p">],</span>
               <span class="ss">method: :delete</span><span class="p">,</span>
               <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s1">'Você tem certeza?'</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0be4fec29c4a79880ca6529ea644e998">&lt;p&gt;
  &lt;strong&gt;Autor do comentário:&lt;/strong&gt;
  &lt;%= comment.commenter %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Comentário:&lt;/strong&gt;
  &lt;%= comment.body %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;%= link_to 'Destruir comentário', [comment.article, comment],
               method: :delete,
               data: { confirm: 'Você tem certeza?' } %&gt;
&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0be4fec29c4a79880ca6529ea644e998">Copiar</button>
</div>
<p>Clicar neste novo link "Destruir comentário" será disparado um <code>DELETE
/articles/:article_id/comments/:id</code> ao nosso <code>CommentsController</code>, que
pode ser usar isso para encontrar o comentário que queremos excluir, então vamos adicionar
uma ação <code>destroy</code> ao nosso <em>controller</em> (<code>app/controllers/comments_controller.rb</code>):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="vi">@comment</span><span class="p">.</span><span class="nf">destroy</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e902384f8442120e978468603a7de9eb">class CommentsController &lt; ApplicationController
  def create
    @article = Article.find(params[:article_id])
    @comment = @article.comments.create(comment_params)
    redirect_to article_path(@article)
  end

  def destroy
    @article = Article.find(params[:article_id])
    @comment = @article.comments.find(params[:id])
    @comment.destroy
    redirect_to article_path(@article)
  end

  private
    def comment_params
      params.require(:comment).permit(:commenter, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e902384f8442120e978468603a7de9eb">Copiar</button>
</div>
<p>A <em>action</em> <code>destroy</code> vai encontrar o artigo que estamos vendo, localizar o
comentário na <em>collection</em> <code>@article.comments</code>, removê-lo do seu banco de
dados e nos enviar de volta para a <em>action</em> <code>show</code> do artigo.</p><h4 id="excluindo-objetos-associados"><a class="anchorlink" href="#excluindo-objetos-associados">8.1 Excluindo objetos associados</a></h4><p>Se você excluir um artigo, os comentários (comments) associados também precisarão ser
excluídos, caso contrário, eles simplesmente ocupariam espaço no banco de dados.
O Rails permite que você use a opção <code>dependent</code> de uma associação para conseguir isso.
Modifique o Modelo de artigo (article), <code>app/models/article.rb</code>, da seguinte forma:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span>
                    <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">5</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-549a23f98e2cc713e68e054bef0c3726">class Article &lt; ApplicationRecord
  has_many :comments, dependent: :destroy
  validates :title, presence: true,
                    length: { minimum: 5 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-549a23f98e2cc713e68e054bef0c3726">Copiar</button>
</div>
<h3 id="seguranca"><a class="anchorlink" href="#seguranca">9 Segurança</a></h3><h4 id="autenticacao-basica"><a class="anchorlink" href="#autenticacao-basica">9.1 Autenticação Básica</a></h4><p>Se fosse fosse publicar o seu blog online, qualquer um poderia adicionar, editar
e deletar seus artigos ou comentários.</p><p>O Rails disponibiliza um sistema de autenticação HTTP simples que irá funcionar
tranquilamente nesta situação.</p><p>No <code>ArticlesController</code> nós precisamos que tenha um meio de bloquear o acesso à
várias ações se uma pessoa não estiver autenticada. Aqui podemos usar o método
<code>http_basic_authenticate_with</code>, que permite o acesso para a ação requisitada se
o método deixar.</p><p>Para usar o sistema de autenticação, nós especificamos no topo do nosso
<code>ArticlesController</code> em <code>app/controllers/articles_controller.rb</code>. No nosso caso,
nós queremos que o usuário esteja autenticado em todas as ações, exceto <code>index</code>
e <code>show</code>, então nós colocamos isso:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">except: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1d0e4d41c7150f632fe81ae54b06a514">class ArticlesController &lt; ApplicationController

  http_basic_authenticate_with name: "dhh", password: "secret", except: [:index, :show]

  def index
    @articles = Article.all
  end

  # snippet for brevity
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1d0e4d41c7150f632fe81ae54b06a514">Copiar</button>
</div>
<p>Nós também queremos autorizar somente usuários autenticados a deletar
comentários, então em <code>CommentsController</code>
(<code>app/controllers/comments_controller.rb</code>) nós colocamos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">only: :destroy</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c58c1217a344450d78b54abd41e815e8">class CommentsController &lt; ApplicationController

  http_basic_authenticate_with name: "dhh", password: "secret", only: :destroy

  def create
    @article = Article.find(params[:article_id])
    # ...
  end

  # snippet for brevity
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c58c1217a344450d78b54abd41e815e8">Copiar</button>
</div>
<p>Agora se você tentar criar um novo artigo, você deverá preencher um formulário de autenticação:</p><p><img src="images/getting_started/challenge.png" alt="Formulário de Autenticação"></p><p>Outros métodos de autenticação estão disponíveis para aplicações Rails. Dois
<em>add-ons</em> de autenticação populares para Rails são o
<a href="https://github.com/plataformatec/devise">Devise</a> e o
<a href="https://github.com/binarylogic/authlogic">Authlogic</a> entre outros.</p><h4 id="outras-consideracoes-de-seguranca"><a class="anchorlink" href="#outras-consideracoes-de-seguranca">9.2 Outras Considerações de Segurança</a></h4><p>Segurança, especialmente em aplicações web, é uma area ampla e detalhada. O
tópico de segurança aplicações Rails é coberto com mais detalhes em
<a href="security.html">Guia de Segurança Ruby on Rails</a>.</p><h3 id="o-que-vem-depois-questionmark"><a class="anchorlink" href="#o-que-vem-depois-questionmark">10 O que vem depois?</a></h3><p>Agora que você criou sua primeira aplicação Rails, sinta-se à vontade para
atualizar e experimentar por conta própria.</p><p>Lembre-se, você não precisa fazer tudo sem ajuda. Se você precisa de
assistência para começar a desenvolver com Rails, sinta-se à vontade para
consultar estes recursos:</p>
<ul>
<li>O <a href="index.html">Guia Rails</a>
</li>
<li>O <a href="https://guides.rubyonrails.org">Ruby on Rails Guides</a>
</li>
<li>A <a href="https://discuss.rubyonrails.org/c/rubyonrails-talk">lista de discussão do Ruby on Rails</a>
</li>
<li>O canal <a href="irc://irc.freenode.net/#rubyonrails">#rubyonrails</a> no irc.freenode.net</li>
</ul>
<h3 id="dicas-de-configuracao"><a class="anchorlink" href="#dicas-de-configuracao">11 Dicas de Configuração</a></h3><p>O caminho mais fácil para se trabalhar com o Rails é armazenar todos os dados
externos como UTF-8. Se não fizer assim, as bibliotecas Ruby e o Rails vão, na
maioria das vezes, conseguir converter seus dados nativos em UTF-8, porém não
é sempre que isso funciona corretamente, então é melhor que você assegure que
todos seus dados externos estão em UTF-8.</p><p>Caso tenha cometido um erro nessa parte, o sintoma mais comum é o aparecimento
de um diamante preto com um ponto de interrogação dentro no seu navegador. Outro
sintoma comum é o aparecimento de caracteres como "Ã¼" ao invés de "ü". O Rails
executa um número de passos internos para mitigar causas comuns desses problemas
que possam ser detectadas e corrigidas automaticamente. Porém, caso você possua
dados externos que não estão armazenados como UTF-8, eles poderão ocasionalmente
resultar em problemas que não podem ser detectados e nem resolvidos de forma
automática pelo Rails.</p><p>Duas fontes muito comuns de dados que não estão em UTF-8 são:</p>
<ul>
<li>Seu editor de texto: A maioria dos editores de texto (como o TextMate), salvam
os arquivos em UTF-8 de forma padrão. Caso o seu editor de texto não salve,
isso pode resultar em caracteres especiais inseridos por você nos seus
<em>templates</em> (como por exemplo: é) aparecerem no navegador como um diamante
com um ponto de interrogação dentro. Isso também se aplica aos seus arquivos
de tradução i18n. Muitos editores que não salvam em UTF-8 por padrão (como
algumas versões do Dreamweaver) oferecem uma forma de alterar o padrão para
UTF-8. Faça isso.</li>
<li>Seu banco de dados: o Rails converte seus dados do banco de dados em UTF-8
de forma padrão. Porém, se seu banco de dados não está utilizando UTF-8
internamente, pode ser que não consiga armazenar todos os caracteres que seus
usuários insiram. Por exemplo, se seu banco de dados está utilizando Latin-1
internamente, e seu usuário inserir um caractere russo, hebraico ou japonês,
os dados serão perdidos para sempre assim que entrarem no banco de dados. Se
possível, utilize UTF-8 como padrão de armazenamento para o seu banco de dados.</li>
</ul>


        <h3>Feedback</h3>
        <p>
          Você é incentivado a ajudar a melhorar a qualidade deste guia.
        </p>
        <p>
          Por favor, contribua se vir qualquer erros, inclusive erros de digitação.
          Para começar, você pode ler nossa sessão de <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">contribuindo com a documentação</a>.
        </p>
        <p>
          Você também pode encontrar conteúdo incompleto ou coisas que não estão atualizadas.
          Por favor, adicione qualquer documentação em falta na master do Rails. Certifique-se de checar o
          <a href="http://edgeguides.rubyonrails.org">Edge Guides (en-US)</a> primeiro para verificar
          se o problema já foi resolvido ou não no branch master.
          Verifique as <a href="ruby_on_rails_guides_guidelines.html">Diretrizes do Guia Ruby on Rails</a>
          para estilo e convenções.
        </p>
        <p>
          Se, por qualquer motivo, você encontrar algo para consertar, mas não conseguir consertá-lo, por favor
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">abra uma issue no nosso Guia</a>.
        </p>
        <p>
          E por último, mas não menos importante, qualquer tipo de discussão sobre a documentação do Ruby on Rails
          é muito bem vinda na <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">lista de discussão rubyonrails-docs</a> e nas
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">issues do Guia em português</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p> Este projeto está licenciado sob uma licença <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a></p>
<p>"Rails", "Ruby on Rails", e o logotipo Rails são marcas comerciais de David Heinemeier Hansson. Todos os direitos reservados.</p>

    </div>
  </div>
</body>
</html>
